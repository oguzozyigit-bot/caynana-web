<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
<meta name="theme-color" content="#000000" />
<title>CAYNANA.AI</title>

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.8/dist/purify.min.js"></script>

<style>
  :root{
    --primary:#00C897;
    --bg-dark:#0b0f18;
    --font:'Plus Jakarta Sans',sans-serif;
  }

  *{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
  html, body{ height:100%; margin:0; }

  /* âœ… WEB: ortala ve telefon gibi gÃ¶ster */
  body{
    font-family:var(--font);
    background:#000;
    overflow:hidden;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  #app{
    width:100%;
    height:100%;
    max-width:480px;
    max-height:920px;
    aspect-ratio: 9 / 19.5;
    border-radius:24px;
    overflow:hidden;
    box-shadow:0 0 50px rgba(0,0,0,0.55);

    position:relative;
    background-color:var(--bg-dark);
    background-size:cover;
    background-position:60% 40%;
    background-repeat:no-repeat;
    transition: background-image 0.25s ease-in-out, background-position .25s ease;
  }

  /* âœ… MOBÄ°L: tam ekran */
  @media (max-width:520px){
    body{ display:block; }
    #app{
      max-width:none;
      max-height:none;
      aspect-ratio:auto;
      border-radius:0;
      width:100vw;
      height:100vh;
      box-shadow:none;
    }
  }

  /* overlay â€“ yazÄ± okunur ama resim boÄŸulmaz */
  #app::after{
    content:'';
    position:absolute; inset:0;
    background:linear-gradient(to top,
      rgba(11,15,24,0.95) 0%,
      rgba(11,15,24,0.78) 22%,
      rgba(11,15,24,0.25) 55%,
      rgba(11,15,24,0.45) 100%
    );
    pointer-events:none;
    z-index:1;
  }

  header{
    position:relative;
    z-index:10;
    padding:16px 20px;
    padding-top:max(16px, env(safe-area-inset-top));
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    gap:14px;
  }

  .brand-group{ display:flex; flex-direction:column; gap:4px; }
  .logo{
    font-weight:800;
    font-size:24px;
    color:#fff;
    display:flex;
    align-items:center;
    gap:10px;
    line-height:1;
  }
  .logo i{ color:var(--primary); }
  .logo span{ color:var(--primary); }

  .slogan{
    font-size:11px;
    font-weight:700;
    color:rgba(255,255,255,0.80);
  }

  .menu-btn{
    width:42px; height:42px;
    border-radius:50%;
    background:rgba(255,255,255,0.14);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    display:flex;
    align-items:center;
    justify-content:center;
    color:#fff;
    border:1px solid rgba(255,255,255,0.12);
    margin-top:2px;
  }

  #container{
    position:relative;
    z-index:5;
    height:100%;
    overflow-y:auto;
    padding:20px;
    padding-bottom:320px; /* âœ… bottom sabit + safe area payÄ± */
    scrollbar-width:none;
    -webkit-overflow-scrolling:touch;
  }
  #container::-webkit-scrollbar{ display:none; }

  #hero-text{
    text-align:center;
    margin-top:64px;
    transition:opacity .25s ease;
  }

  #hero-title{
    font-size:36px;
    font-weight:800;
    line-height:1.1;
    color:#fff;
    text-shadow:0 6px 22px rgba(0,0,0,0.65);
    margin-bottom:10px;
  }
  #hero-desc{
    font-size:16px;
    color:rgba(255,255,255,0.92);
    font-weight:600;
    text-shadow:0 4px 18px rgba(0,0,0,0.55);
  }

  /* Chat */
  #chat-area{ margin-top:18px; display:none; }
  .msg-row{ display:flex; margin-bottom:16px; }
  .msg-row.user{ justify-content:flex-end; }
  .bubble{
    max-width:85%;
    padding:14px 18px;
    border-radius:20px;
    font-size:15px;
    line-height:1.5;
    word-wrap:break-word;
    font-weight:650;
  }
  .msg-row.ai .bubble{
    background:rgba(255,255,255,0.95);
    color:#1a1a1a;
    border-bottom-left-radius:6px;
  }
  .msg-row.user .bubble{
    background:var(--primary);
    color:#fff;
    border-bottom-right-radius:6px;
  }

  .image-preview{ width:100%; border-radius:12px; margin-bottom:10px; }

  /* Cards */
  .cards-wrapper{ display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:10px; }
  .card{
    background:#fff;
    border-radius:16px;
    padding:10px;
    display:flex;
    flex-direction:column;
    box-shadow:0 5px 15px rgba(0,0,0,0.12);
    position:relative;
    overflow:hidden;
  }
  .badge{
    position:absolute;
    top:10px; left:0;
    padding:4px 10px;
    font-size:10px;
    font-weight:900;
    color:#fff;
    border-top-right-radius:10px;
    border-bottom-right-radius:10px;
    z-index:2;
  }
  .badge.gold{ background:linear-gradient(90deg,#FFD700,#FFA500); }
  .badge.value{ background:linear-gradient(90deg,#00C897,#009688); }
  .badge.silver{ background:linear-gradient(90deg,#9E9E9E,#6f6f6f); }

  .card-img{ width:100%; height:110px; object-fit:cover; border-radius:12px; margin-bottom:8px; background:#f1f1f1; }
  .card-title{ font-size:12px; font-weight:800; color:#333; margin-bottom:4px; overflow:hidden; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; }
  .card-price{ font-size:14px; font-weight:900; color:var(--primary); margin-bottom:8px; }
  .card-btn{
    margin-top:auto;
    background:#111;
    color:#fff;
    text-align:center;
    padding:9px;
    border-radius:10px;
    font-size:11px;
    font-weight:900;
    text-decoration:none;
  }

  /* âœ… Bottom fixed â€” mobilde ok kaybolmaz */
  #bottom-bar{
    position:fixed;
    left:0; right:0; bottom:0;
    z-index:20;
    background:rgba(255,255,255,0.92);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-top:1px solid rgba(255,255,255,0.35);
    padding-bottom:calc(env(safe-area-inset-bottom) + 18px);
    padding-top:14px;
  }

  /* bottom iÃ§ini app ile hizala */
  #bottom-bar .inner{
    max-width:480px;
    margin:0 auto;
    width:100%;
  }
  @media (max-width:520px){ #bottom-bar .inner{ max-width:none; } }

  #suggestion{
    position:absolute;
    top:-44px;
    left:50%;
    transform:translateX(-50%);
    background:#fff;
    padding:9px 16px;
    border-radius:22px;
    font-size:12px;
    font-weight:900;
    color:var(--primary);
    box-shadow:0 10px 24px rgba(0,0,0,0.18);
    white-space:nowrap;
  }

  .input-area{
    padding:0 15px;
    display:flex;
    align-items:center;
    gap:10px;
  }
  .input-box{
    flex:1;
    height:52px;
    background:#fff;
    border-radius:26px;
    display:flex;
    align-items:center;
    padding:0 6px;
    border:1px solid rgba(0,0,0,0.06);
  }
  .tool-btn{
    width:40px; height:40px;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#666;
    cursor:pointer;
  }
  #user-input{
    flex:1;
    border:none;
    outline:none;
    font-size:15px;
    padding:0 8px;
    font-family:var(--font);
    background:transparent;
  }
  #send-btn{
    width:52px; height:52px;
    border-radius:50%;
    border:none;
    background:var(--primary);
    color:#fff;
    font-size:18px;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow:0 10px 22px rgba(0,200,151,0.25);
  }
  #send-btn:active{ transform:scale(0.92); }

  .dock{
    display:flex;
    gap:12px;
    padding:10px 15px 0 15px;
    overflow-x:auto;
    scrollbar-width:none;
  }
  .dock::-webkit-scrollbar{ display:none; }
  .dock-item{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:4px;
    opacity:0.45;
    transition:0.25s;
    cursor:pointer;
    min-width:64px;
  }
  .dock-item.active{ opacity:1; transform:translateY(-2px); }
  .dock-icon{
    width:46px; height:46px;
    border-radius:16px;
    background:rgba(0,0,0,0.06);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:18px;
    color:#333;
  }
  .dock-item.active .dock-icon{
    background:var(--primary);
    color:#fff;
    box-shadow:0 8px 18px rgba(0,0,0,0.18);
  }
  .dock-label{ font-size:10px; font-weight:900; color:#333; }

  .footer-info{
    text-align:center;
    font-size:10px;
    color:#777;
    font-weight:800;
    margin-top:8px;
    padding-bottom:2px;
  }
  .it-flag-line{
    width:62px; height:4px;
    margin:6px auto 0;
    border-radius:3px;
    overflow:hidden;
    display:flex;
  }
  .it-flag-line span{ flex:1; }
  .it-flag-line .g{ background:#009246; }
  .it-flag-line .w{ background:#fff; }
  .it-flag-line .r{ background:#ce2b37; }

  /* âœ… â€œDosya seÃ§â€ asla gÃ¶rÃ¼nmesin */
  #file-upload{ display:none !important; }
</style>
</head>

<body>
<div id="app">
  <header>
    <div class="brand-group">
      <div class="logo"><i class="fa-solid fa-wand-magic-sparkles"></i>CAYNANA<span>.AI</span></div>
      <div class="slogan">Yapay ZekÃ¢nÄ±n Geleneksel AklÄ±</div>
    </div>
    <div class="menu-btn"><i class="fa-solid fa-bars"></i></div>
  </header>

  <div id="container">
    <div id="hero-text">
      <div id="hero-title">Almadan Ã¶nce<br>Caynanaâ€™ya sor.</div>
      <div id="hero-desc">Sonra â€œkeÅŸkeâ€ dememek iÃ§in buradayÄ±m.</div>
    </div>
    <div id="chat-area"></div>
  </div>

  <div id="bottom-bar">
    <div class="inner">
      <div id="suggestion">Her indirime atlayan sonunda pahalÄ± Ã¶der.</div>

      <div class="input-area">
        <div class="input-box">
          <div class="tool-btn" onclick="openCamera()"><i class="fa-solid fa-camera"></i></div>
          <input type="text" id="user-input" placeholder="Ne danÄ±ÅŸmak istersin?" autocomplete="off">
          <div class="tool-btn" id="mic-btn"><i class="fa-solid fa-microphone"></i></div>
        </div>
        <button id="send-btn" onclick="sendMessage()"><i class="fa-solid fa-paper-plane"></i></button>
      </div>

      <div class="dock" id="dock-container"></div>

      <div class="footer-info">@CaynanaAI by Italky Technology</div>
      <div class="it-flag-line"><span class="g"></span><span class="w"></span><span class="r"></span></div>
    </div>
  </div>
</div>

<input type="file" id="file-upload" accept="image/*" capture="environment">

<script>
  // âœ… EÄŸer backend aynÄ± domain'de ise (caynana.ai) bunu kullan:
  const API_BASE_URL = "/api/chat";

  // EÄŸer Render gibi ayrÄ±ysa bunu yap:
  // const API_BASE_URL = "https://YOUR-RENDER-URL/api/chat";

  const MODES = {
    shopping: { label:"AlÄ±ÅŸveriÅŸ", icon:"fa-bag-shopping", color:"#00C897", img:"images/hero-shopping.png", title:"Almadan Ã¶nce<br>Caynanaâ€™ya sor.", desc:"Sonra â€œkeÅŸkeâ€ dememek iÃ§in buradayÄ±m.", sugg:"Her indirime atlayan sonunda pahalÄ± Ã¶der.", ph:"Neye bakmÄ±ÅŸtÄ±n evladÄ±m?" },
    chat: { label:"Sohbet", icon:"fa-comments", color:"#FFB300", img:"images/hero-chat.png", title:"Caynana ile<br>dertleÅŸ.", desc:"Anlat bakalÄ±m, canÄ±nÄ± sÄ±kan ne?", sugg:"Eskiden komÅŸuluk vardÄ±, ÅŸimdi wifi varâ€¦", ph:"Naber Caynana?" },
    fal: { label:"Fal", icon:"fa-mug-hot", color:"#8B5CF6", img:"images/hero-fal.png", title:"Kahveni iÃ§tin mi?<br>Gel falÄ±na bakayÄ±m.", desc:"Neyse halin, Ã§Ä±ksÄ±n falin.", sugg:"Kapat fincanÄ±, fotoÄŸrafÄ±nÄ± Ã§ek gÃ¶nder.", ph:"FincanÄ± Ã§ektin mi?" },
    health: { label:"SaÄŸlÄ±k", icon:"fa-heart-pulse", color:"#EF4444", img:"images/hero-health.png", title:"SaÄŸlÄ±k olsun<br>gerisi boÅŸ.", desc:"Neren aÄŸrÄ±yor evladÄ±m?", sugg:"Terli terli soÄŸuk su iÃ§me!", ph:"ÅikÃ¢yetin ne?" },
    diet: { label:"Diyet", icon:"fa-apple-whole", color:"#84CC16", img:"images/hero-diet.png", title:"SaÄŸlÄ±klÄ± beslen<br>zinde kal.", desc:"AÃ§ kalarak deÄŸil, dengeli ye.", sugg:"AkÅŸam 7'den sonra buzdolabÄ±na kÃ¼s.", ph:"Hedefin ne?" },
    food: { label:"Yemek", icon:"fa-utensils", color:"#F97316", img:"images/hero-food.png", title:"BugÃ¼n ne<br>piÅŸirsem?", desc:"Dolapta ne var sÃ¶yle, tarif vereyim.", sugg:"Malzemeyi ziyan etme, bereket kaÃ§ar.", ph:"Hangi malzemeler var?" },
    law: { label:"Hukuk", icon:"fa-scale-balanced", color:"#3B82F6", img:"images/hero-law.png", title:"HakkÄ±nÄ±<br>yedirme.", desc:"DanÄ±ÅŸmadan imza atma evladÄ±m.", sugg:"SÃ¶z uÃ§ar yazÄ± kalÄ±r.", ph:"Sorun nedir?" },
    astro: { label:"BurÃ§", icon:"fa-star", color:"#D946EF", img:"images/hero-astro.png", title:"YÄ±ldÄ±zlar<br>ne diyor?", desc:"MerkÃ¼r retrosuna dikkat.", sugg:"YÄ±ldÄ±znameye baktÄ±m, yolun aÃ§Ä±k.", ph:"Burcun ne?" },
    translate: { label:"Ã‡eviri", icon:"fa-language", color:"#64748B", img:"images/hero-translate.png", title:"Dil bilmek<br>altÄ±n bileziktir.", desc:"AnlamadÄ±ÄŸÄ±n yazÄ±yÄ± gÃ¶ster Ã§evireyim.", sugg:"Turist gelince mahcup olma.", ph:"Ã‡evrilecek metin ne?" },
    dream: { label:"RÃ¼ya", icon:"fa-cloud-moon", color:"#6366F1", img:"images/hero-dream.png", title:"RÃ¼yalar<br>haberci olabilir.", desc:"HayÄ±rdÄ±r inÅŸallahâ€¦", sugg:"Suya anlat derler ama sen bana anlat.", ph:"RÃ¼yanda ne gÃ¶rdÃ¼n?" },
  };

  let currentMode="shopping";
  let pendingImage=null;
  let chatHistory={};

  marked.setOptions({ mangle:false, headerIds:false });

  function init(){ renderDock(); switchMode("shopping"); setupSwipe(); }

  function renderDock(){
    const dock=document.getElementById("dock-container");
    dock.innerHTML="";
    Object.keys(MODES).forEach(key=>{
      const m=MODES[key];
      const el=document.createElement("div");
      el.className=`dock-item ${key===currentMode?"active":""}`;
      el.onclick=()=>switchMode(key);
      el.innerHTML=`<div class="dock-icon"><i class="fa-solid ${m.icon}"></i></div><div class="dock-label">${m.label}</div>`;
      dock.appendChild(el);
    });
  }

  function switchMode(mode){
    if(!MODES[mode]) return;
    const chatArea=document.getElementById("chat-area");
    chatHistory[currentMode]=chatArea.innerHTML;

    currentMode=mode;
    const m=MODES[mode];

    document.documentElement.style.setProperty("--primary", m.color);
    document.getElementById("hero-title").innerHTML=m.title;
    document.getElementById("hero-desc").innerHTML=m.desc;
    document.getElementById("suggestion").innerText=m.sugg;
    document.getElementById("user-input").placeholder=m.ph;

    // bg
    document.getElementById("app").style.backgroundImage=`url('${m.img}?v=${Date.now()}')`;
    renderDock();

    chatArea.innerHTML = chatHistory[mode] || "";
    toggleHero(chatArea.innerHTML.trim()==="");
  }

  function toggleHero(show){
    const hero=document.getElementById("hero-text");
    hero.style.opacity=show?"1":"0";
    hero.style.pointerEvents=show?"all":"none";
    document.getElementById("chat-area").style.display=show?"none":"block";
  }

  function addMessage(role, text, imgData){
    const area=document.getElementById("chat-area");
    const row=document.createElement("div");
    row.className=`msg-row ${role}`;

    let content="";
    if(imgData) content += `<img src="${imgData}" class="image-preview">`;

    if(role==="ai"){
      const html = DOMPurify.sanitize(marked.parse(text||""));
      content += html;
    }else{
      content += DOMPurify.sanitize(text||"");
    }

    row.innerHTML=`<div class="bubble">${content}</div>`;
    area.appendChild(row);
    document.getElementById("container").scrollTo(0, document.getElementById("container").scrollHeight);
  }

  function addLoading(){
    const id="loading-"+Date.now();
    const area=document.getElementById("chat-area");
    const row=document.createElement("div");
    row.className="msg-row ai";
    row.id=id;
    row.innerHTML=`<div class="bubble"><i class="fa-solid fa-circle-notch fa-spin"></i> BakÄ±yorum evladÄ±mâ€¦</div>`;
    area.appendChild(row);
    return id;
  }
  function removeLoading(id){ const el=document.getElementById(id); if(el) el.remove(); }

  async function sendMessage(){
    const input=document.getElementById("user-input");
    const txt=input.value.trim();

    if(!txt && !pendingImage) return;

    toggleHero(false);

    if(currentMode==="shopping"){
      document.querySelectorAll(".cards-wrapper").forEach(el=>el.remove());
    }

    addMessage("user", txt, pendingImage);
    input.value="";

    const loadingId = addLoading();

    const payload = { message: txt, mode: currentMode, image: pendingImage };
    pendingImage=null;

    try{
      const res = await fetch(API_BASE_URL, {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      removeLoading(loadingId);
      addMessage("ai", data.assistant_text || "Bir ÅŸey diyemedim evladÄ±mâ€¦");
      if(data.data && data.data.length) renderCards(data.data);
    }catch(e){
      removeLoading(loadingId);
      addMessage("ai", "Backend adresini kontrol et evladÄ±m. API_BASE_URL yanlÄ±ÅŸ.");
      console.error(e);
    }
  }

  function renderCards(list){
    const area=document.getElementById("chat-area");
    const wrapper=document.createElement("div");
    wrapper.className="cards-wrapper";

    list.forEach(item=>{
      const badgeClass = (item.badge || "silver");
      const badgeText =
        badgeClass==="gold" ? "Ã–NERÄ°LEN" :
        badgeClass==="value" ? "F/P" : "SEÃ‡Ä°M";

      const safeUrl = (item.url && (item.url.startsWith("http://") || item.url.startsWith("https://"))) ? item.url : "#";
      const card=document.createElement("div");
      card.className="card";
      card.innerHTML = `
        <div class="badge ${badgeClass}">${badgeText}</div>
        <img src="${item.image || 'https://via.placeholder.com/150'}" class="card-img" onerror="this.src='https://via.placeholder.com/150'">
        <div class="card-title">${DOMPurify.sanitize(item.title || '')}</div>
        <div class="card-price">${DOMPurify.sanitize(item.price || '')}</div>
        <a href="${safeUrl}" target="_blank" class="card-btn" rel="noopener noreferrer">Ä°NCELE</a>
      `;
      wrapper.appendChild(card);
    });

    area.appendChild(wrapper);
    document.getElementById("container").scrollTo(0, document.getElementById("container").scrollHeight);
  }

  function openCamera(){ document.getElementById("file-upload").click(); }
  document.getElementById("file-upload").addEventListener("change", (e)=>{
    const file=e.target.files && e.target.files[0];
    if(!file) return;
    const r=new FileReader();
    r.onload = (evt)=>{
      pendingImage = evt.target.result;
      document.getElementById("user-input").value = "ğŸ“· FotoÄŸraf eklendi";
      document.getElementById("user-input").focus();
    };
    r.readAsDataURL(file);
  });

  function setupSwipe(){
    let startX=0;
    const app=document.getElementById("app");
    app.addEventListener("touchstart", e=>{ startX=e.changedTouches[0].screenX; }, {passive:true});
    app.addEventListener("touchend", e=>{
      const endX=e.changedTouches[0].screenX;
      if(Math.abs(startX-endX)<60) return;
      const keys=Object.keys(MODES);
      const i=keys.indexOf(currentMode);
      if(endX<startX) switchMode(keys[(i+1)%keys.length]);
      else switchMode(keys[(i-1+keys.length)%keys.length]);
    }, {passive:true});
  }

  document.getElementById("user-input").addEventListener("keypress",(e)=>{ if(e.key==="Enter") sendMessage(); });

  init();
</script>
</body>
</html>
