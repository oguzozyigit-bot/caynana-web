<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>CAYNANA</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
  :root {
    --primary: #10B981; /* Ye≈üil */
    --primary-dark: #059669;
    --bg: #FFFFFF;
    --chat-bg: #F9FAFB;
    --user-msg: #10B981;
    --ai-msg: #F3F4F6;
  }

  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

  body {
    margin: 0;
    font-family: 'Inter', sans-serif;
    background-color: var(--bg);
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  /* --- HERO SECTION (GOOGLE TARZI) --- */
  #hero-section {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: all 0.4s ease;
    padding: 20px;
  }
  #hero-section.minimized {
    flex: 0;
    padding: 10px 20px;
    border-bottom: 1px solid #E5E7EB;
    flex-direction: row;
    justify-content: space-between;
    height: 60px;
  }

  .logo {
    font-size: 42px;
    font-weight: 800;
    color: #1F2937;
    letter-spacing: -1px;
    margin-bottom: 30px;
    transition: all 0.4s ease;
  }
  .logo span { color: var(--primary); }
  
  #hero-section.minimized .logo {
    font-size: 20px;
    margin-bottom: 0;
  }

  /* --- CHAT AREA --- */
  #chat-container {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    display: none; /* Ba≈ülangƒ±√ßta gizli */
    flex-direction: column;
    gap: 15px;
    background: var(--chat-bg);
  }
  #chat-container.active { display: flex; }

  /* Mesajlar */
  .msg-row { display: flex; flex-direction: column; width: 100%; max-width: 800px; margin: 0 auto; }
  .msg-row.user { align-items: flex-end; }
  .msg-row.ai { align-items: flex-start; }

  .bubble {
    padding: 12px 18px;
    border-radius: 20px;
    font-size: 15px;
    line-height: 1.5;
    max-width: 85%;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
  }
  .msg-row.user .bubble { background: var(--user-msg); color: white; border-bottom-right-radius: 4px; }
  .msg-row.ai .bubble { background: var(--ai-msg); color: #1F2937; border-bottom-left-radius: 4px; }

  /* --- INPUT AREA --- */
  .input-wrapper {
    width: 100%;
    max-width: 600px;
    position: relative;
    transition: all 0.4s ease;
  }
  #hero-section.minimized + .footer .input-wrapper { max-width: 100%; }

  .search-box {
    width: 100%;
    padding: 16px 50px 16px 20px;
    border: 2px solid #E5E7EB;
    border-radius: 30px;
    font-size: 16px;
    outline: none;
    background: white;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
    transition: 0.3s;
  }
  .search-box:focus { border-color: var(--primary); box-shadow: 0 10px 15px -3px rgba(16, 185, 129, 0.1); }

  .search-btn {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    width: 40px; height: 40px;
    border-radius: 50%;
    background: var(--primary);
    color: white;
    border: none;
    font-size: 18px;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
  }

  /* CHIPS (√ñNERƒ∞LER) */
  .chips {
    display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; justify-content: center;
  }
  #hero-section.minimized .chips { display: none; } /* Chat a√ßƒ±lƒ±nca gizle */

  .chip {
    background: #F3F4F6;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 500;
    color: #4B5563;
    cursor: pointer;
    border: 1px solid transparent;
    transition: 0.2s;
  }
  .chip:hover { border-color: var(--primary); color: var(--primary); background: #ECFDF5; }

  /* FOOTER (Chat modunda input a≈üaƒüƒ± iner) */
  .footer {
    padding: 15px 20px;
    background: white;
    border-top: 1px solid #E5E7EB;
    display: none;
  }
  .footer.active { display: block; }

  /* Y√ºkleniyor */
  .typing { display: none; font-size: 12px; color: #9CA3AF; padding: 10px; text-align: center; font-style: italic; }

</style>
</head>
<body>

<div id="hero-section">
  <div class="logo">CAYNANA<span>.AI</span></div>
  
  <div class="input-wrapper" id="mainInputWrap">
    <input type="text" id="mainInput" class="search-box" placeholder="Ne arƒ±yorsun evladƒ±m?" onkeypress="if(event.key==='Enter') startChat()">
    <button class="search-btn" onclick="startChat()"><i class="fa-solid fa-paper-plane"></i></button>
  </div>

  <div class="chips">
    <div class="chip" onclick="fill('Fal bak (Fincan)')">‚òï Kahve Falƒ±</div>
    <div class="chip" onclick="fill('Bug√ºn ne giysem?')">üëó Ne Giysem?</div>
    <div class="chip" onclick="fill('N√∂bet√ßi eczane')">üíä Eczane</div>
    <div class="chip" onclick="fill('Airfryer √∂nerisi')">üçü Alƒ±≈üveri≈ü</div>
  </div>
</div>

<div id="chat-container"></div>
<div class="typing" id="typingIndicator">Kaynanan yazƒ±yor...</div>

<div class="footer" id="footer"></div>

<script>
  const API_URL = "https://bikonomi-api-1.onrender.com/api/chat";
  const hero = document.getElementById('hero-section');
  const chatContainer = document.getElementById('chat-container');
  const footer = document.getElementById('footer');
  const inputWrap = document.getElementById('mainInputWrap');
  const mainInput = document.getElementById('mainInput');
  const typing = document.getElementById('typingIndicator');

  let isChatActive = false;

  function fill(txt) {
    mainInput.value = txt;
    startChat();
  }

  function startChat() {
    const txt = mainInput.value.trim();
    if(!txt) return;

    if (!isChatActive) {
        // UI D√∂n√º≈ü√ºm√º (Google -> Chat)
        isChatActive = true;
        hero.classList.add('minimized');
        chatContainer.classList.add('active');
        footer.classList.add('active');
        footer.appendChild(inputWrap); // Inputu a≈üaƒüƒ± ta≈üƒ±
        mainInput.focus();
    }

    addMsg(txt, 'user');
    mainInput.value = '';
    
    // API √áaƒürƒ±sƒ±
    typing.style.display = 'block';
    chatContainer.scrollTop = chatContainer.scrollHeight;

    fetch(API_URL, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ message: txt, user: { city: 'ƒ∞stanbul', gender: 'neutral' } })
    })
    .then(res => res.json())
    .then(data => {
        typing.style.display = 'none';
        addMsg(data.reply || data.assistant_text, 'ai');
        
        // Kartlar varsa
        if(data.data && Array.isArray(data.data)) {
            // Basit kart listesi (text olarak)
            let cardsText = data.data.map(c => `‚Ä¢ ${c.title} (${c.price || c.desc})`).join('\n');
            if(cardsText) addMsg(cardsText, 'ai');
        }
    })
    .catch(() => {
        typing.style.display = 'none';
        addMsg("Baƒülantƒ± koptu evladƒ±m.", 'ai');
    });
  }

  function addMsg(txt, type) {
    const row = document.createElement('div');
    row.className = `msg-row ${type}`;
    row.innerHTML = `<div class="bubble">${txt.replace(/\n/g, '<br>')}</div>`;
    chatContainer.appendChild(row);
    chatContainer.scrollTop = chatContainer.scrollHeight;
  }
</script>

</body>
</html>
