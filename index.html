<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=resizes-content" />
<title>Caynana AI v4.4 Final</title>
<link rel="icon" href="data:,">
<script src="https://accounts.google.com/gsi/client" async defer></script>

<style>
Â  /* --- 1. TEMEL AYARLAR --- */
Â  :root { --bg-outer: #000; --bg: #0e0e0e; --text: #ececec; --gold: #ffb300; --pistachio: #bef264; --glass: rgba(20, 20, 20, 0.98); --border: rgba(255, 255, 255, 0.12); --lip-color: #d84315; }
Â  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
Â  body, html { margin: 0; padding: 0; width: 100%; height: 100dvh; background: var(--bg-outer); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; color: var(--text); overflow: hidden; display: flex; align-items: center; justify-content: center; }

Â  /* Global Scroll Gizleme */
Â  ::-webkit-scrollbar { display: none; }
Â  * { -ms-overflow-style: none; scrollbar-width: none; }

Â  .mobile-frame { width: 100%; height: 100%; max-width: 480px; background: var(--bg); position: relative; display: flex; flex-direction: column; box-shadow: 0 0 50px rgba(255, 255, 255, 0.05); overflow: hidden; }
Â  @media (min-width: 500px) { .mobile-frame { height: 95dvh; border-radius: 24px; border: 1px solid #333; } }

Â  /* --- 2. TOPBAR (ToparlandÄ±) --- */
Â  .topbar { flex: 0 0 65px; background: var(--glass); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 12px; z-index: 3000; }
Â  .left-controls { display: flex; align-items: center; width: 80px; } /* Sabit geniÅŸlik ile denge */
Â  .right-controls { display: flex; align-items: center; gap: 8px; justify-content: flex-end; width: auto; }
Â  .hamb-btn { background: none; border: none; cursor: pointer; color: #aaa; font-size: 26px; padding: 5px; }

Â  /* Marka Ortada */
Â  .brand-wrapper { display: flex; flex-direction: column; align-items: center; flex: 1; transition: transform 0.4s; }
Â  .logo-area { display: flex; align-items: center; gap: 6px; }
Â  .brand-name { font-weight: 800; font-size: 15px; color: #fff; letter-spacing: 0.5px; }
Â  .slogan { font-size: 9px; color: #888; margin-top: 1px; font-weight: 500; }

Â  .seesaw-svg { width: 32px; height: 16px; overflow: visible; }
Â  .seesaw-bar { transform-origin: 20px 8px; transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
Â  /* Animasyonlar */
Â  .brand-wrapper.usering .seesaw-bar { transform: rotate(-15deg); }
Â  .brand-wrapper.botting .seesaw-bar { transform: rotate(15deg); }
Â  .brand-wrapper.thinking .seesaw-bar { animation: rock 1s infinite ease-in-out; }
Â  @keyframes rock { 0%,100% {transform: rotate(-5deg);} 50% {transform: rotate(5deg);} }

Â  /* YP Chip */
Â  .yp-chip { display: flex; align-items: center; gap: 6px; padding: 4px 8px; border: 1px solid #333; background: #151515; border-radius: 99px; cursor: help; margin-right: 4px; }
Â  .yp-label { font-size: 8px; color: #777; font-weight: 800; }
Â  .yp-meter { width: 40px; height: 4px; border-radius: 2px; background: #222; overflow: hidden; }
Â  .yp-fill { height: 100%; width: 50%; background: linear-gradient(90deg, #ff5252, #ffb300, #bef264); transition: width 0.5s; }
Â  .yp-num { font-size: 9px; color: #ccc; font-weight: 700; width: 22px; text-align: right; }

Â  /* SaÄŸ Ä°konlar */
Â  .notif-row { display: flex; align-items: center; gap: 5px; position:relative; }
Â  .icon-btn-top { background: none; border: none; cursor: pointer; padding: 6px; display: flex; align-items: center; position:relative; }
Â  .icon-btn-top svg { width: 22px; height: 22px; stroke: #aaa; fill: none; stroke-width: 2; transition: 0.2s; }
Â  .icon-btn-top:active svg { stroke: var(--gold); }
Â  .badge { position: absolute; top: 4px; right: 4px; width: 6px; height: 6px; background: #ff5252; border-radius: 50%; display: none; }

Â  /* --- 3. FACE TRACKING (GÃ¶zler Geri Geldi - v2.6 YapÄ±sÄ±) --- */
Â  .face-container { flex: 0 0 0px; background: linear-gradient(to bottom, var(--bg), transparent); overflow: hidden; transition: flex-basis 0.5s; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; z-index: 2500; }
Â  .mobile-frame.tracking-active .face-container { flex-basis: 150px; }
Â  .face-panel-inner { opacity: 0; transition: 0.4s; transform: translateY(-20px); width: 100%; display: flex; flex-direction: column; align-items: center; }
Â  .mobile-frame.tracking-active .face-panel-inner { opacity: 1; transform: translateY(0); }

Â  .eyes-row { display: flex; gap: 24px; margin-bottom: 8px; }
Â  .eye { width: 80px; height: 55px; position: relative; --gx:0px; --gy:0px; transition: 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
Â  .sclera { width: 100%; height: 100%; background: #e0e0e0; border-radius: 50%; overflow: hidden; position: relative; border: 2px solid #1a1a1a; box-shadow: inset 0 0 10px rgba(0,0,0,0.8); }
Â  .iris { width: 30px; height: 30px; background: radial-gradient(circle, #5d4037 0%, #281a16 100%); border-radius: 50%; position: absolute; top: 50%; left: 50%; transform: translate(calc(-50% + var(--gx)), calc(-50% + var(--gy))); border: 1px solid rgba(255,255,255,0.25); transition: transform 0.1s linear; }
Â  .pupil { width: 10px; height: 10px; background: #000; border-radius: 50%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
Â  .lid-top, .lid-bot { position: absolute; left: 0; width: 100%; background: var(--bg); z-index: 10; transition: height 0.3s ease-in-out; }
Â  .lid-top { top: 0; height: var(--lidTop, 0%); border-bottom: 2px solid #222; }
Â  .lid-bot { bottom: 0; height: var(--lidBot, 0%); border-top: 2px solid #222; }

Â  .mouth-wrapper { width: 50px; height: 20px; display: flex; justify-content: center; margin-top: 5px; }
Â  .mouth { width: 30px; height: 5px; background: var(--lip-color); border-radius: 10px; opacity: 0.9; }

Â  /* âœ… KonuÅŸurken aÄŸÄ±z kÄ±pÄ±rdasÄ±n (tasarÄ±m bozulmaz) */
Â  .mobile-frame.talking .mouth{ animation: mouthTalk .22s infinite alternate ease-in-out; }
Â  @keyframes mouthTalk{ from{ transform:scaleX(1) } to{ transform:scaleX(1.6) } }

Â  .track-btn-row { display: flex; justify-content: center; width: 100%; height: 24px; overflow: hidden; transition: 0.3s; opacity: 1; }
Â  .mobile-frame.tracking-active .track-btn-row { height: 0; opacity: 0; }
Â  .track-toggle-btn { background: rgba(255,179,0,0.15); color: var(--gold); border: 1px solid var(--gold); padding: 3px 12px; border-radius: 12px; font-size: 9px; cursor: pointer; backdrop-filter: blur(4px); margin-bottom: 5px; }

Â  /* Uyku Modu */
Â  .mobile-frame.sleeping .lid-top { height: 60% !important; }
Â  .mobile-frame.sleeping .lid-bot { height: 20% !important; }
Â  .mobile-frame.sleeping .iris { opacity: 0.6; }

Â  /* --- 4. CHAT ALANI --- */
Â  .chat-area { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
Â  .bubble { max-width: 85%; padding: 10px 14px; border-radius: 14px; font-size: 14px; line-height: 1.4; word-wrap: break-word; flex-shrink: 0; animation: pop 0.2s ease; }
Â  .bubble.bot { align-self: flex-start; background: #1c1c1c; border-left: 3px solid var(--gold); color: #ddd; border-top-left-radius: 2px; position:relative; }
Â  .bubble.user { align-self: flex-end; background: #222; border-right: 3px solid var(--pistachio); color: #fff; border-top-right-radius: 2px; text-align: right; }
Â  @keyframes pop { from{transform:scale(0.95);opacity:0.5} to{transform:scale(1);opacity:1} }

Â  /* âœ… Beklerken turuncu Ã§izgi yavaÅŸ dolsun */
Â  .bubble.bot.loading{opacity:.95}
Â  .bubble.bot.loading::before{
Â  Â  content:"";
Â  Â  position:absolute;
Â  Â  left:-3px; top:0;
Â  Â  width:3px; height:0%;
Â  Â  background:var(--gold);
Â  Â  border-radius:3px;
Â  Â  animation:loadFill 1.6s ease-in-out infinite;
Â  }
Â  @keyframes loadFill{
Â  Â  0%{height:0%}
Â  Â  60%{height:100%}
Â  Â  100%{height:100%}
Â  }

Â  /* --- 5. DOCK (DÃ¼zenlendi) --- */
Â  .input-dock { flex: 0 0 auto; background: transparent; padding: 0 10px; z-index: 3000; display: flex; flex-direction: column; align-items: center; position: relative; margin-bottom: 5px; }

Â  .dock-inner { width: 100%; max-width: 380px; height: 50px; display: flex; align-items: center; gap: 6px; background: #1a1a1a; border: 1px solid #333; border-radius: 25px; padding: 0 6px; box-shadow: 0 5px 25px rgba(0,0,0,0.3); }

Â  .icon-btn { width: 38px; height: 38px; border-radius: 50%; border: none; background: transparent; display: flex; align-items: center; justify-content: center; cursor: pointer; flex-shrink: 0; }
Â  .icon-btn svg { width: 20px; height: 20px; stroke: #aaa; stroke-width: 2; fill: none; transition: 0.2s; }
Â  .icon-btn:hover svg { stroke: var(--gold); }

Â  textarea { flex: 1; background: transparent; border: none; outline: none; color: #fff; font-size: 14px; padding: 15px 5px; height: 48px; max-height: 48px; font-family: inherit; resize: none; white-space: nowrap; overflow: hidden; line-height: 1.3; }

Â  .send-btn { width: 38px; height: 38px; border-radius: 50%; background: var(--pistachio); color: #000; border: none; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 10px rgba(190, 242, 100, 0.2); }
Â  .send-btn svg { width: 20px; height: 20px; fill: none; stroke: #000; stroke-width: 2; }

Â  /* --- 6. MENÃœ (Izgara YapÄ±sÄ±) --- */
Â  .menu-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 5000; opacity: 0; pointer-events: none; transition: 0.3s; backdrop-filter: blur(5px); display:flex; }
Â  .menu-overlay.open { opacity: 1; pointer-events: auto; }
Â  .menu-sidebar { width: 280px; height: 100%; background: #111; padding: 20px; transform: translateX(-100%); transition: 0.3s; display: flex; flex-direction: column; border-right: 1px solid #333; overflow-y: auto; }
Â  .menu-overlay.open .menu-sidebar { transform: translateX(0); }

Â  .new-chat-btn { width: 100%; background: var(--pistachio); color: #000; border: none; padding: 12px; border-radius: 10px; font-weight: bold; cursor: pointer; margin-bottom: 20px; font-size: 13px; display:flex; justify-content:center; align-items:center; gap:6px; }
Â  .section-title { font-size: 10px; color: #666; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; font-weight: 700; margin-top: 15px; border-bottom: 1px solid #222; padding-bottom: 5px; }

Â  .recent-chat-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #1a1a1a; border-radius: 8px; font-size: 13px; color: #ccc; cursor: pointer; margin-bottom: 5px; }
Â  .del-chat { background: none; border: none; font-size: 14px; cursor: pointer; opacity: 0.6; padding: 0 6px; color:#ff5252; }

Â  /* Izgara MenÃ¼ */
Â  .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 10px; }
Â  .menu-action { background: #161616; border: 1px solid #333; border-radius: 10px; padding: 12px; text-align: center; cursor: pointer; transition: 0.2s; display:flex; flex-direction:column; align-items:center; gap:5px; }
Â  .menu-action:hover { border-color: var(--gold); background: #222; }
Â  .menu-action .ico { font-size: 20px; }
Â  .menu-action div div { font-size: 13px; color: #ddd; font-weight: 600; }
Â  .menu-action small { font-size: 10px; color: #777; display: block; margin-top: 2px; }

Â  .menu-footer-actions { margin-top: auto; padding-top: 20px; border-top: 1px solid #222; display: flex; flex-direction: column; gap: 8px; }
Â  .action-link { font-size: 12px; color: #ccc; text-decoration: none; padding: 12px; cursor: pointer; display: block; background: #1a1a1a; border-radius: 8px; margin-bottom: 5px; text-align: center; font-weight: 500; transition: 0.2s; }
Â  .delete-acc { background: transparent; border: 1px solid #333; color: #b71c1c !important; margin-top: 30px; }

Â  /* --- OVERLAYS --- */
Â  .full-overlay { position: absolute; inset: 0; background: #000; z-index: 6000; display: flex; flex-direction: column; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: 0.3s; padding: 20px; }
Â  .full-overlay.active { opacity: 1; pointer-events: auto; }

Â  .login-card { width: 100%; max-width: 320px; text-align: center; }

Â  /* âœ… Login UI Upgrade (Google ikonlu) */
Â  .auth-btn {
Â  Â  width: 100%;
Â  Â  padding: 12px 14px;
Â  Â  border-radius: 14px;
Â  Â  margin-bottom: 12px;
Â  Â  cursor: pointer;
Â  Â  border: 1px solid #ddd;
Â  Â  background: #fff;
Â  Â  font-size: 14px;
Â  Â  font-weight: 800;
Â  Â  display: flex;
Â  Â  align-items: center;
Â  Â  justify-content: center;
Â  Â  gap: 10px;
Â  Â  transition: .2s;
Â  }
Â  .auth-btn:active{ transform: scale(.99); }
Â  .auth-btn .auth-ico{ width:18px; height:18px; display:inline-block; }
Â  .auth-btn.google{ color:#2b2b2b; }
Â  .auth-btn.apple{ background:#000; color:#fff; border:1px solid #333; }
Â  .auth-btn.disabled{ opacity:.5; pointer-events:none; filter:grayscale(1); }
Â  .login-sub{ font-size:12px; color:#888; margin-top:-4px; margin-bottom:10px; }

Â  .login-links { margin-top: 30px; display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; border-top: 1px solid #222; padding-top: 20px; }
Â  .login-links a { color: #666; font-size: 11px; text-decoration: none; transition: 0.2s; }
Â  .login-links a:hover { color: var(--gold); }
Â  .login-copy { margin-top: 12px; font-size: 12px; color: #444; font-weight: 600; }

Â  .agreement-box { display: flex; align-items: center; gap: 10px; font-size: 12px; color: #aaa; justify-content: center; margin-top: 20px; margin-bottom: 20px; }
Â  .agreement-box input { width: 20px; height: 20px; accent-color: var(--gold); cursor: pointer; }

Â  .footer-container { text-align: center; width: 100%; padding: 10px 0; background: transparent; border-top: 1px solid #1a1a1a; margin-top: 5px; }
Â  .footer-links { display: flex; justify-content: center; gap: 12px; margin-bottom: 5px; }
Â  .footer-links a { color: #555; font-size: 10px; text-decoration: none; }
Â  .footer-brand { font-size: 9px; color: #444; font-weight: 600; }

Â  /* BÄ°LDÄ°RÄ°M */
Â  .notification-dropdown { position: absolute; top: 65px; right: 10px; width: 280px; background: #1c1c1c; border: 1px solid #333; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.6); z-index: 4000; display: none; flex-direction: column; }
Â  .notification-dropdown.show { display: flex; animation: slideDown 0.2s ease; }
Â  @keyframes slideDown { from {opacity:0; transform:translateY(-10px);} to {opacity:1; transform:translateY(0);} }
Â  .notif-item { padding: 10px; border-bottom: 1px solid #2a2a2a; display: flex; gap: 8px; align-items: flex-start; }
Â  .notif-title { font-size: 12px; color: #fff; font-weight: 600; }
Â  .notif-desc { font-size: 11px; color: #aaa; }

Â  #camVideo { display: none; }
</style>
</head>
<body>

<div class="mobile-frame" id="mobileFrame">

Â  <div class="topbar">
Â  Â  <div class="left-controls"><button class="hamb-btn" id="hambBtn" type="button">â˜°</button></div>

Â  Â  <div class="brand-wrapper" id="brandWrapper">
Â  Â  Â  <div class="logo-area">
Â  Â  Â  Â  <svg class="seesaw-svg" viewBox="0 0 40 20">
Â  Â  Â  Â  Â  <g class="seesaw-bar" id="seesawBar">
Â  Â  Â  Â  Â  Â  <line x1="0" y1="8" x2="40" y2="8" stroke="#ccc" stroke-width="2" stroke-linecap="round" />
Â  Â  Â  Â  Â  Â  <circle cx="3" cy="5" r="3" fill="#bef264" />
Â  Â  Â  Â  Â  Â  <circle cx="37" cy="5" r="3" fill="#ffb300" id="orangeBall" />
Â  Â  Â  Â  Â  </g>
Â  Â  Â  Â  Â  <polygon points="17,14 23,14 20,8" fill="none" stroke="#666" stroke-width="1.5" />
Â  Â  Â  Â  </svg>
Â  Â  Â  Â  <div class="brand-name">Caynana AI</div>
Â  Â  Â  </div>
Â  Â  Â  <div class="slogan">Yapay ZekÃ¢nÄ±n Geleneksel AklÄ±</div>
Â  Â  </div>

Â  Â  <div class="right-controls">
Â  Â  Â  <div class="yp-chip" title="Samimiyet">
Â  Â  Â  Â  <div class="yp-label">SAMÄ°MÄ°YET</div>
Â  Â  Â  Â  <div class="yp-meter"><div class="yp-fill" id="ypFill"></div></div>
Â  Â  Â  Â  <div class="yp-num" id="ypNum">50%</div>
Â  Â  Â  </div>

Â  Â  Â  <div class="notif-row">
Â  Â  Â  Â  <button class="icon-btn-top" id="notifBtn" type="button">
Â  Â  Â  Â  Â  <svg viewBox="0 0 24 24"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
Â  Â  Â  Â  Â  <div class="badge" id="notifBadge"></div>
Â  Â  Â  Â  </button>
Â  Â  Â  Â  <div class="notification-dropdown" id="notifDropdown">
Â  Â  Â  Â  Â  <div class="notif-header">Bildirimler</div>
Â  Â  Â  Â  Â  <div class="notif-list" id="notifList"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <button class="icon-btn-top" id="profileBtn" type="button" onclick="location.href='pages/profil.html'">
Â  Â  Â  Â  Â  <svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
Â  Â  Â  Â  </button>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  <div class="menu-overlay" id="menuOverlay">
Â  Â  <div class="menu-sidebar">
Â  Â  Â  <button class="new-chat-btn" id="newChatBtn" type="button"><span>+</span> YENÄ° SOHBET</button>

Â  Â  Â  <div class="section-title">Son 5 Sohbet</div>
Â  Â  Â  <div class="history-list" id="historyList"></div>

Â  Â  Â  <div class="section-title">Asistan</div>
Â  Â  Â  <div class="menu-grid" id="mainMenu">
Â  Â  Â  Â  <div class="menu-action" data-action="shopping"><div class="ico">ğŸ›ï¸</div><div><div>AlÄ±ÅŸveriÅŸ</div><small>Tasarruf et</small></div></div>
Â  Â  Â  Â  <div class="menu-action" data-action="translate"><div class="ico">ğŸŒ</div><div><div>TercÃ¼man</div><small>Ã‡eviri yap</small></div></div>
Â  Â  Â  Â  <div class="menu-action" data-action="diet"><div class="ico">ğŸ¥—</div><div><div>Diyet</div><small>BugÃ¼n ne yesek</small></div></div>
Â  Â  Â  Â  <div class="menu-action" data-action="health"><div class="ico">â¤ï¸</div><div><div>SaÄŸlÄ±k</div><small>DanÄ±ÅŸma</small></div></div>
Â  Â  Â  Â  <div class="menu-action" data-action="special"><div class="ico">ğŸ‰</div><div><div>Ã–zel GÃ¼n</div><small>HatÄ±rlatÄ±cÄ±</small></div></div>
Â  Â  Â  Â  <div class="menu-action" data-action="reminder"><div class="ico">â°</div><div><div>HatÄ±rlatÄ±cÄ±</div><small>Alarm kur</small></div></div>
Â  Â  Â  </div>

Â  Â  Â  <div class="section-title">Mistik</div>
Â  Â  Â  <div class="menu-grid">
Â  Â  Â  Â  <div class="menu-action" data-action="fal"><div class="ico">â˜•</div><div><div>Kahve FalÄ±</div><small>GÃ¼nde 1</small></div></div>
Â  Â  Â  Â  <div class="menu-action" data-action="tarot"><div class="ico">ğŸƒ</div><div><div>Tarot</div><small>Kart seÃ§</small></div></div>
Â  Â  Â  Â  <div class="menu-action" data-action="horoscope"><div class="ico">â™ˆ</div><div><div>BurÃ§</div><small>GÃ¼nlÃ¼k</small></div></div>
Â  Â  Â  Â  <div class="menu-action" data-action="dream"><div class="ico">ğŸŒ™</div><div><div>RÃ¼ya Tabiri</div><small>Yorumla</small></div></div>
Â  Â  Â  </div>

Â  Â  Â  <div class="menu-footer-actions">
Â  Â  Â  Â  <a class="action-link" id="logoutBtn">ğŸ›¡ï¸ GÃ¼venli Ã‡Ä±kÄ±ÅŸ</a>
Â  Â  Â  Â  <a class="action-link delete-acc" id="deleteAccountBtn">ğŸ—‘ï¸ HesabÄ±mÄ± Sil</a>
Â  Â  Â  Â  <div class="footer-copy" style="margin-top:10px;">@CaynanaAI By Ozyigits</div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  <div class="face-container" id="faceContainer">
Â  Â  <div class="face-panel-inner" id="faceInner">
Â  Â  Â  <div class="eyes-row">
Â  Â  Â  Â  <div class="eye" id="eyeL">
Â  Â  Â  Â  Â  <div class="sclera"><div class="iris"><div class="pupil"></div><div class="reflection"></div></div></div>
Â  Â  Â  Â  Â  <div class="lid-top"></div><div class="lid-bot"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="eye" id="eyeR">
Â  Â  Â  Â  Â  <div class="sclera"><div class="iris"><div class="pupil"></div><div class="reflection"></div></div></div>
Â  Â  Â  Â  Â  <div class="lid-top"></div><div class="lid-bot"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  <div class="mouth-wrapper"><div class="mouth"></div></div>
Â  Â  Â  <button class="track-toggle-btn" style="margin-top:10px;" onclick="window.toggleCam()">Kapat</button>
Â  Â  </div>
Â  </div>

Â  <div class="chat-area" id="chat"></div>

Â  <div class="input-dock">
Â  Â  <div class="track-btn-row">
Â  Â  Â  <button class="track-toggle-btn" onclick="window.toggleCam()">ğŸ‘ï¸ TAKÄ°P ET</button>
Â  Â  </div>
Â  Â  <div class="dock-inner">
Â  Â  Â  <button class="icon-btn" id="camBtn" onclick="window.toggleCam()"><svg viewBox="0 0 24 24"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg></button>
Â  Â  Â  <textarea id="msgInput" rows="1" placeholder="Ne lazÄ±m evladÄ±m?" spellcheck="false"></textarea>
Â  Â  Â  <button class="icon-btn" id="micBtn" type="button"><svg viewBox="0 0 24 24"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg></button>
Â  Â  Â  <button class="send-btn" id="sendBtn" type="button"><svg viewBox="0 0 24 24"><path d="M22 2L11 13"></path><path d="M22 2L15 22L11 13L2 9L22 2Z"></path></svg></button>
Â  Â  </div>
Â  </div>

Â  <div class="footer-container">
Â  Â  <div class="footer-links">
Â  Â  Â  <a href="pages/hakkimizda.html">HakkÄ±mÄ±zda</a>
Â  Â  Â  <a href="pages/sss.html">SSS</a>
Â  Â  Â  <a href="pages/gizlilik.html">Gizlilik</a>
Â  Â  Â  <a href="pages/iletisim.html">Ä°letiÅŸim</a>
Â  Â  </div>
Â  Â  <div class="footer-brand">@CaynanaAI By Ozyigits</div>
Â  </div>

</div>

<div class="full-overlay" id="falOverlay" style="background:#111; z-index:7000; display:none;">
Â  <button onclick="document.getElementById('falOverlay').style.display='none'" style="position:absolute; top:20px; right:20px; background:none; border:none; font-size:30px; color:#fff;">&times;</button>
Â  <div style="text-align:center; margin-top:60px; color:#d9f99d;"><h2>Kaynana Fal</h2></div>
Â  <div style="flex:1; display:flex; justify-content:center; align-items:center;">
Â  Â  <label class="send-btn" style="width:80px; height:80px;">
Â  Â  Â  <input type="file" style="display:none;" onchange="alert('Fal resmi alÄ±ndÄ±.'); document.getElementById('falOverlay').style.display='none';">
Â  Â  Â  <svg viewBox="0 0 24 24" width="30"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>
Â  Â  </label>
Â  </div>
</div>

<div class="full-overlay active" id="loginOverlay">
Â  <div class="login-card">
Â  Â  <div class="brand-name" style="font-size:24px; margin-bottom:5px;">Caynana.AI</div>
Â  Â  <div style="font-size:12px; color:#888; margin-bottom:12px;">Yapay ZekÃ¢nÄ±n Geleneksel AklÄ±</div>

Â  Â  <button class="auth-btn google disabled" id="googleLoginBtn" type="button" title="Google">
Â  Â  Â  <svg class="auth-ico" viewBox="0 0 24 24" aria-hidden="true">
Â  Â  Â  Â  <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
Â  Â  Â  Â  <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
Â  Â  Â  Â  <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
Â  Â  Â  Â  <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
Â  Â  Â  </svg>
Â  Â  Â  Google ile Devam Et
Â  Â  </button>

Â  Â  <button class="auth-btn apple disabled" id="appleLoginBtn" type="button" title="Apple">
Â  Â  Â  <svg class="auth-ico" viewBox="0 0 24 24" fill="#fff" aria-hidden="true">
Â  Â  Â  Â  <path d="M17.05 20.28c-.98.95-2.05.88-3.08.4-1.09-.5-2.08-.48-3.24.02-1.44.62-2.2.44-3.06-.4C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.74s2.57-.91 4.35-.68c.75.04 2.86.32 3.9 1.83-3.23 1.6-2.67 6.38 1.02 7.94-.75 1.49-1.81 2.97-2.89 4.01l-.22.25-.24-.12zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.54 4.33-3.74 4.25z"/>
Â  Â  Â  </svg>
Â  Â  Â  Apple ile Devam Et
Â  Â  </button>

Â  Â  <div class="login-sub" id="loginHint">Google yÃ¼kleniyorâ€¦</div>
Â  Â  Â  <div class="login-copy">@CaynanaAI By Ozyigits</div>
Â  </div>
</div>

<div class="full-overlay" id="termsOverlay" style="z-index:6500; background:#000; display:none;">
Â  <div class="login-card" style="max-width:350px;">
Â  Â  <div class="brand-name">SÃ¶zleÅŸme</div>
Â  Â  <div style="font-size:12px; color:#888; margin-bottom:10px;">Onayla evladÄ±m.</div>
Â  Â  <div style="border:1px solid #333; height:200px; overflow-y:auto; font-size:10px; text-align:left; padding:10px; margin-bottom:10px; background:#111;">
Â  Â  Â  <p>1. Caynana AI eÄŸlence amaÃ§lÄ±dÄ±r...</p>
Â  Â  </div>
Â  Â  <div class="agreement-box">
Â  Â  Â  <input type="checkbox" id="termsCheck"> <label for="termsCheck">Okudum, onaylÄ±yorum.</label>
Â  Â  </div>
Â  Â  <button class="auth-btn" id="termsAcceptBtn" type="button">Onayla ve Gir</button>
Â  </div>
</div>

<video id="camVideo" autoplay playsinline muted></video>

<script type="module">
// --- CONFIG & IMPORTS ---
import { initAuth, handleLogin, logout, acceptTerms } from './js/auth.js';
import { fetchTextResponse, addUserBubble, typeWriter as typeWriterLib } from './js/chat.js';
import { BASE_DOMAIN, STORAGE_KEY } from './js/config.js';
import { openFalPanel, closeFalPanel, handleFalPhoto } from './js/fal.js';

const $ = (id) => document.getElementById(id);
let chatHistory = [], idleTimer = null, isTracking = false;

// --- âœ… GSI WAIT (async script yÃ¼zÃ¼nden) ---
async function waitForGsi(timeoutMs = 8000){
Â  const t0 = Date.now();
Â  while (Date.now() - t0 < timeoutMs){
Â  Â  if (window.google?.accounts?.id) return true;
Â  Â  await new Promise(r => setTimeout(r, 50));
Â  }
Â  return false;
}
function enableAuthButtons(){
Â  const gBtn = $("googleLoginBtn");
Â  const aBtn = $("appleLoginBtn");
Â  const hint = $("loginHint");
Â  if(gBtn){ gBtn.classList.remove("disabled"); }
Â  if(aBtn){ aBtn.classList.remove("disabled"); } // Apple hazÄ±r deÄŸilse yine de tÄ±klatÄ±r; aÅŸaÄŸÄ±da uyaracaÄŸÄ±z
Â  if(hint){ hint.textContent = "Devam et evladÄ±m."; }
}

// --- 1. EYES ENGINE (V2.6 RESTORED) ---
function setGaze(x, y) {
Â  const L=$("eyeL"), R=$("eyeR");
Â  if(!L || !R) return;
Â  const gx = Math.min(Math.max(x*20, -20), 20);
Â  const gy = Math.min(Math.max(y*15, -15), 15);
Â  L.style.setProperty('--gx', gx+'px'); L.style.setProperty('--gy', gy+'px');
Â  R.style.setProperty('--gx', gx+'px'); R.style.setProperty('--gy', gy+'px');
}
function setLids(top, bot=0) {
Â  const L=$("eyeL"), R=$("eyeR");
Â  if(!L || !R) return;
Â  [L,R].forEach(e=>{
Â  Â  Â e.querySelector('.lid-top').style.height = top+'%';
Â  Â  Â e.querySelector('.lid-bot').style.height = bot+'%';
Â  });
}
function autoLook() {
Â  if($("mobileFrame").classList.contains("sleeping") || isTracking) return;
Â  const rx = (Math.random()-0.5)*1.5, ry = (Math.random()-0.5)*0.5;
Â  setGaze(rx, ry);
Â  setTimeout(()=>setGaze(0,0), 1000);
}
function resetIdle() {
Â  $("mobileFrame").classList.remove("sleeping");
Â  setLids(0,0);
Â  clearTimeout(idleTimer);
Â  idleTimer = setTimeout(() => {
Â  Â  if(!isTracking) {
Â  Â  Â  Â $("mobileFrame").classList.add("sleeping");
Â  Â  Â  Â setLids(60,20);
Â  Â  }
Â  }, 30000);
}
window.addEventListener("pointermove", (e) => {
Â  resetIdle();
Â  if(isTracking) return;
Â  const rect = $("mobileFrame").getBoundingClientRect();
Â  const x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
Â  const y = ((e.clientY - rect.top) / rect.height) * 2 - 1;
Â  setGaze(x,y);
});

// --- 2. CHAT LOGIC ---
async function doSend(forcedText=null){
Â  const inputEl = $("msgInput");
Â  const txt = (forcedText ?? inputEl?.value ?? "").trim();
Â  if(!txt) return;

Â  // UI
Â  setBrandState("usering");
Â  addUserBubble(txt);
Â  if(inputEl && forcedText==null) inputEl.value = "";
Â  chatHistory.push({ role: "user", content: txt });

Â  // Backend
Â  setTimeout(()=> setBrandState("thinking"), 150);

Â  // Loading bubble (turuncu Ã§izgi dolsun)
Â  const holder = document.createElement("div");
Â  holder.className = "bubble bot loading";
Â  holder.textContent = "â€¦";
Â  $("chat")?.appendChild(holder);
Â  holder.scrollIntoView({behavior:"smooth", block:"end"});

Â  let reply = "EvladÄ±m bir ÅŸeyler ters gitti.";
Â  try{
Â  Â  const out = await fetchTextResponse(txt, "chat");
Â  Â  reply = out?.text || reply;
Â  }catch(e){
Â  Â  console.log("Chat fetch error:", e);
Â  }
Â  try{ holder.remove(); }catch(e){}

Â  // Reply
Â  setBrandState("botting");
Â  setTimeout(()=> setBrandState("talking"), 120);
Â  typeWriterLib(reply, "chat");
Â  chatHistory.push({ role: "assistant", content: reply });
Â  setTimeout(()=> setBrandState(null), 600);
}

function setBrandState(state){
Â  const b = $("brandWrapper");
Â  const frame = $("mobileFrame");
Â  if(b) {
Â  Â  b.classList.remove("usering","botting","thinking","talking");
Â  Â  if(state) b.classList.add(state);
Â  }
Â  if(frame){
Â  Â  frame.classList.remove("usering","botting","thinking","talking");
Â  Â  if(state) frame.classList.add(state); // âœ… mouth animasyonu buradan tetikleniyor
Â  }
}

// --- 3. MENU & INIT ---
function handleMenuAction(action){
Â  $("menuOverlay").classList.remove("open");
Â  if(action==="fal"){ openFalPanel(); return; }
Â  if(action==="shopping"){ doSend("AlÄ±ÅŸveriÅŸ moduna geÃ§elim: Ne almak istiyorsun?"); return; }
Â  if(action==="translate"){ doSend("TercÃ¼man: Metni yapÄ±ÅŸtÄ±r, dili sÃ¶yle (TR/EN/DE/AR vs)."); return; }
Â  if(action==="diet"){ doSend("Diyet: BugÃ¼n hedefin nedir; kilo mu, koruma mÄ±?"); return; }
Â  if(action==="health"){ doSend("SaÄŸlÄ±k: Ne ÅŸikayetin var evladÄ±m?"); return; }
Â  if(action==="special"){ doSend("Ã–zel GÃ¼n: Hangi tarihleri hatÄ±rlatayÄ±m?"); return; }
Â  if(action==="reminder"){ location.href = "pages/hatirlatici.html"; return; }

Â  // Mistik sayfalar
Â  if(action==="tarot"){ location.href="pages/tarot.html"; return; }
Â  if(action==="horoscope"){ location.href="pages/burc.html"; return; }
Â  if(action==="dream"){ location.href="pages/ruya.html"; return; }

Â  // fallback
Â  location.href = `pages/${action}.html`;
}

document.addEventListener("DOMContentLoaded", async () => {
Â  // Init
Â  resetIdle();
Â  setInterval(autoLook, 4000);

Â  // âœ… GSI bekle -> butonlarÄ± aÃ§ -> auth init
Â  const okGsi = await waitForGsi();
Â  console.log("GSI ready:", okGsi, "google.accounts.id:", !!window.google?.accounts?.id);
Â  if(okGsi) enableAuthButtons();
Â  else {
Â  Â  const hint = $("loginHint");
Â  Â  if(hint) hint.textContent = "Google yÃ¼klenemedi evladÄ±m (GSI yok).";
Â  }
Â  if(typeof initAuth === "function") initAuth();

Â  // Buttons
Â  $("sendBtn")?.addEventListener("click", () => doSend());
Â  $("msgInput")?.addEventListener("keydown", (e) => {
Â  Â  if(e.key==="Enter" && !e.shiftKey){ e.preventDefault(); doSend(); }
Â  });

Â  $("hambBtn")?.addEventListener("click", () => $("menuOverlay").classList.add("open"));
Â  $("menuOverlay")?.addEventListener("click", (e) => { if(e.target.id==="menuOverlay") $("menuOverlay").classList.remove("open"); });

Â  // Menu Actions
Â  document.querySelectorAll(".menu-action").forEach(el => {
Â  Â  el.addEventListener("click", () => handleMenuAction(el.getAttribute("data-action")));
Â  });

Â  // Camera Toggle (gÃ¶z tasarÄ±mÄ± bozulmadan aynÄ±)
Â  const camT = () => {
Â  Â  $("mobileFrame").classList.toggle("tracking-active");
Â  Â  isTracking = !isTracking;
Â  Â  resetIdle();
Â  };
Â  $("camBtn")?.addEventListener("click", camT);
Â  window.toggleCam = camT;

Â  // NOTIF dropdown toggle (basit)
Â  $("notifBtn")?.addEventListener("click", () => {
Â  Â  $("notifDropdown")?.classList.toggle("show");
Â  });

Â  // âœ… REAL Login Logic
Â  $("googleLoginBtn")?.addEventListener("click", async () => {
Â  Â  try{
Â  Â  Â  await handleLogin("google");
Â  Â  Â  const u = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");

Â  Â  Â  $("loginOverlay")?.classList.remove("active");

Â  Â  Â  if(!u.terms_accepted_at && !u.termsAccepted){
Â  Â  Â  Â  $("termsOverlay").style.display="flex";
Â  Â  Â  }else{
Â  Â  Â  Â  const name = u.fullname || u.name || u.email || "EvladÄ±m";
Â  Â  Â  Â  setTimeout(()=> typeWriterLib(`HoÅŸ geldin ${name}. Ben Caynana.`, "chat"), 500);
Â  Â  Â  }
Â  Â  }catch(e){
Â  Â  Â  console.log("Google login error:", e);
Â  Â  Â  alert("Google ile giriÅŸ baÅŸarÄ±sÄ±z evladÄ±m. Console'a bak.");
Â  Â  }
Â  });

Â  $("appleLoginBtn")?.addEventListener("click", async () => {
Â  Â  alert("Apple ile giriÅŸ yakÄ±nda evladÄ±m.");
Â  });

Â  $("termsAcceptBtn")?.addEventListener("click", async () => {
Â  Â  if(!$("termsCheck").checked) return alert("Onayla evladÄ±m.");
Â  Â  try{
Â  Â  Â  const ok = await acceptTerms();
Â  Â  Â  if(!ok) throw new Error("acceptTerms false");

Â  Â  Â  $("termsOverlay").style.display="none";
Â  Â  Â  const u = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
Â  Â  Â  const name = u.fullname || u.name || u.email || "EvladÄ±m";
Â  Â  Â  setTimeout(()=> typeWriterLib(`HoÅŸ geldin ${name}. Ben Caynana.`, "chat"), 500);
Â  Â  }catch(e){
Â  Â  Â  console.log("Terms accept error:", e);
Â  Â  Â  alert("SÃ¶zleÅŸme onayÄ± kaydedilemedi evladÄ±m.");
Â  Â  }
Â  });

Â  // Session Check
Â  const user = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
Â  if(user && (user.id || user.email)) {
Â  Â  $("loginOverlay")?.classList.remove("active");
Â  Â  if(!user.terms_accepted_at && !user.termsAccepted) {
Â  Â  Â  $("termsOverlay").style.display="flex";
Â  Â  } else {
Â  Â  Â  const name = user.fullname || user.name || user.email || "EvladÄ±m";
Â  Â  Â  setTimeout(()=> typeWriterLib(`HoÅŸ geldin ${name}.`, "chat"), 500);
Â  Â  }
Â  }
});

// Global Helpers
window.toggleMenu = () => $("menuOverlay")?.classList.toggle("open");
window.openFal = openFalPanel;
window.closeFal = closeFalPanel;
window.handleFalFile = handleFalPhoto;
</script>
</body>
</html>
