<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=resizes-content" />
<title>Caynana AI v7.5 Profile</title>
<style>
  /* --- MEVCUT CSS (Deƒüi≈ümedi) --- */
  :root { --bg-outer: #000; --bg: #0e0e0e; --text: #ececec; --gold: #ffb300; --pistachio: #bef264; --glass: rgba(20, 20, 20, 0.98); --border: rgba(255, 255, 255, 0.12); --lip-color: #d84315; --card-bg: #1a1a1a; }
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  body, html { margin: 0; padding: 0; width: 100%; height: 100dvh; background: var(--bg-outer); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; color: var(--text); overflow: hidden; display: flex; align-items: center; justify-content: center; }
  .mobile-frame { width: 100%; height: 100%; max-width: 480px; background: var(--bg); position: relative; display: flex; flex-direction: column; box-shadow: 0 0 50px rgba(255, 255, 255, 0.05); overflow: hidden; }
  @media (min-width: 500px) { .mobile-frame { height: 95dvh; border-radius: 24px; border: 1px solid #333; } }
  
  /* --- YENƒ∞ EKLENEN: PROFIL MODAL CSS --- */
  .modal-overlay {
    position: absolute; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);
    z-index: 5000; opacity: 0; pointer-events: none; transition: 0.3s;
    display: flex; align-items: center; justify-content: center; padding: 20px;
  }
  .modal-overlay.open { opacity: 1; pointer-events: auto; }
  
  .profile-card {
    width: 100%; max-width: 360px; background: #161616; border: 1px solid #333; border-radius: 24px;
    padding: 24px; display: flex; flex-direction: column; gap: 16px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.5); transform: translateY(20px); transition: 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    max-height: 85vh; overflow-y: auto;
  }
  .modal-overlay.open .profile-card { transform: translateY(0); }

  .p-header { text-align: center; margin-bottom: 10px; }
  .p-avatar { width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--gold); object-fit: cover; margin: 0 auto 10px; display: block; background: #333; }
  .p-title { font-size: 18px; font-weight: 700; color: #fff; }
  .p-desc { font-size: 12px; color: #888; margin-top: 4px; }

  .form-group { display: flex; flex-direction: column; gap: 6px; }
  .form-label { font-size: 11px; color: var(--gold); font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
  .form-input, .form-select {
    background: #222; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 12px;
    font-size: 14px; outline: none; transition: 0.2s; width: 100%;
  }
  .form-input:focus, .form-select:focus { border-color: var(--gold); background: #2a2a2a; }
  .form-input:disabled { opacity: 0.5; cursor: not-allowed; }

  .save-btn {
    background: var(--gold); color: #000; border: none; padding: 14px; border-radius: 12px;
    font-weight: 700; cursor: pointer; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 8px;
    transition: 0.2s;
  }
  .save-btn:active { transform: scale(0.96); }
  
  .close-modal-btn {
    position: absolute; top: 16px; right: 16px; background: none; border: none; color: #666; font-size: 20px; cursor: pointer;
  }

  /* --- MEVCUT CSS DEVAMI (√ñzetlendi) --- */
  .topbar { flex: 0 0 70px; background: var(--glass); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 16px; z-index: 3000; }
  .left-controls { display: flex; gap: 15px; align-items: center; }
  .hamb-btn { background: none; border: none; cursor: pointer; color: #aaa; font-size: 24px; padding: 0; }
  .brand-wrapper { display: flex; flex-direction: column; align-items: center; margin-right: 40px; flex: 1;}
  .logo-area { display: flex; align-items: center; gap: 8px; }
  .brand-name { font-weight: 700; font-size: 16px; color: #fff; }
  .slogan { font-size: 10px; color: #888; margin-top: 2px; }
  .seesaw-svg { width: 36px; height: 18px; overflow: visible; }
  .seesaw-bar { transform-origin: 18px 14px; transition: transform 0.4s; }
  .face-container { flex: 0 0 0px; background: linear-gradient(to bottom, var(--bg), transparent); overflow: hidden; transition: flex-basis 0.5s; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; z-index: 2500; }
  .mobile-frame.tracking-active .face-container { flex-basis: 180px; }
  .face-panel-inner { width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; opacity: 0; transform: translateY(-30px); transition: 0.4s; }
  .mobile-frame.tracking-active .face-panel-inner { opacity: 1; transform: translateY(0); }
  .eyes-row { display: flex; gap: 24px; margin-bottom: 10px; }
  .eye { width: 90px; height: 65px; position: relative; --lidTop:0%; --lidBot:0%; --gx:0px; --gy:0px; transition: 0.1s; }
  .brow { position: absolute; top: -14px; left: 0; width: 100%; height: 16px; background: #222; border-radius: 99px; transform-origin: center; transition: 0.3s; box-shadow: 0 3px 6px rgba(0,0,0,0.5); }
  .sclera { width: 100%; height: 100%; background: #e0e0e0; border-radius: 50%; overflow: hidden; position: relative; border: 2px solid #1a1a1a; box-shadow: inset 0 0 8px rgba(0,0,0,0.8); }
  .iris { width: 32px; height: 32px; background: radial-gradient(circle, #5d4037 0%, #281a16 100%); border-radius: 50%; position: absolute; top: 50%; left: 50%; transform: translate(calc(-50% + var(--gx)), calc(-50% + var(--gy))); border: 1px solid rgba(255,255,255,0.25); transition: transform 0.08s linear; }
  .pupil { width: 10px; height: 10px; background: #000; border-radius: 50%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
  .reflection { position: absolute; top: 6px; right: 6px; width: 4px; height: 4px; background: #fff; border-radius: 50%; opacity: 0.9; }
  .lid-top, .lid-bot { position: absolute; left: 0; width: 100%; background: var(--bg); z-index: 10; transition: height 0.1s; }
  .lid-top { top: 0; height: var(--lidTop); border-bottom: 2px solid #222; }
  .lid-bot { bottom: 0; height: var(--lidBot); border-top: 2px solid #222; }
  .mouth-wrapper { width: 60px; height: 26px; display: flex; justify-content: center; align-items: center; position: relative; margin-top: 8px; }
  .mouth { width: 40px; height: 10px; border-top: 3px solid var(--lip-color); border-radius: 50% 50% 0 0; position: absolute; top: 8px; transition: 0.15s; opacity: 0.9; }
  .mobile-frame.speaking .mouth { height: 18px; width: 36px; background: #3e2723; border: 2px solid var(--lip-color); border-radius: 50%; top: 5px; animation: talkAnim 0.15s infinite alternate; }
  @keyframes talkAnim { 0% { transform: scaleY(0.8); } 100% { transform: scaleY(1.1); } }
  .mobile-frame.mumbling .mouth { transform: scaleX(1.15); border-color: #ff5722; }
  .close-track-btn { margin-top: 10px; background: rgba(198, 40, 40, 0.2); color: #ef9a9a; border: 1px solid rgba(198, 40, 40, 0.5); padding: 5px 14px; border-radius: 20px; font-size: 11px; cursor: pointer; }
  .chat-area { flex: 1; overflow-y: auto; padding: 20px 16px; display: flex; flex-direction: column; gap: 16px; scroll-behavior: smooth; scrollbar-width: none; }
  .chat-area::-webkit-scrollbar { display: none; }
  .bubble { max-width: 85%; padding: 12px 14px; border-radius: 18px; font-size: 15px; line-height: 1.4; position: relative; animation: pop 0.2s ease; word-wrap: break-word; }
  @keyframes pop { from{transform:translateY(10px);opacity:0}to{transform:translateY(0);opacity:1}}
  .bubble.bot { align-self: flex-start; background: #1c1c1c; border-left: 3px solid var(--gold); color: #ddd; border-top-left-radius: 4px; min-height: 40px;}
  .bubble.user { align-self: flex-end; background: #222; border-right: 3px solid var(--pistachio); color: #fff; border-top-right-radius: 4px; text-align: right; }
  .input-dock { flex: 0 0 auto; background: var(--glass); padding: 10px 16px 25px 16px; z-index: 3000; border-top: 1px solid var(--border); display: flex; flex-direction: column; gap: 10px; }
  .track-trigger-row { display: flex; justify-content: center; width: 100%; transition: 0.3s; height: 36px; overflow: hidden; }
  .mobile-frame.tracking-active .track-trigger-row { height: 0; margin: 0; opacity: 0; pointer-events: none; }
  .main-track-btn { background: rgba(255, 179, 0, 0.15); border: 1px solid var(--gold); color: var(--gold); padding: 8px 24px; border-radius: 24px; cursor: pointer; font-size: 13px; font-weight: 600; box-shadow: 0 0 15px rgba(255, 179, 0, 0.1); animation: pulseBtn 2s infinite; display: flex; align-items: center; gap: 8px; }
  @keyframes pulseBtn { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
  .dock-inner { display: flex; align-items: flex-end; gap: 8px; background: #1a1a1a; border: 1px solid #333; border-radius: 24px; padding: 6px; }
  .icon-btn { width: 42px; height: 42px; border-radius: 50%; border: none; background: transparent; color: #888; display: flex; align-items: center; justify-content: center; cursor: pointer; flex-shrink: 0; transition: 0.2s; }
  .icon-btn.active { color: var(--gold); background: rgba(255,179,0,0.15); }
  .send-btn { width: 42px; height: 42px; border-radius: 50%; background: var(--pistachio); color: #000; border: none; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 10px rgba(190, 242, 100, 0.3); }
  textarea { flex: 1; background: transparent; border: none; outline: none; color: #fff; font-size: 16px; resize: none; padding: 10px; max-height: 100px; min-height: 24px; font-family: inherit; scrollbar-width: none; }
  
  .menu-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 4000; opacity: 0; pointer-events: none; transition: 0.3s; backdrop-filter: blur(5px); display:flex; justify-content: flex-start;}
  .menu-overlay.open { opacity: 1; pointer-events: auto; }
  .menu-sidebar { width: 260px; height: 100%; background: #161616; padding: 80px 20px; transform: translateX(-100%); transition: 0.3s; display: flex; flex-direction: column; gap: 20px; border-right: 1px solid #333; box-shadow: 5px 0 20px rgba(0,0,0,0.5); }
  .menu-overlay.open .menu-sidebar { transform: translateX(0); }
  .menu-item { color: #ccc; text-decoration: none; border-bottom: 1px solid #333; padding-bottom: 10px; font-size: 16px; cursor: pointer; }
  #camVideo { display: none; }
</style>
</head>
<body>

<div class="mobile-frame" id="mobileFrame">
  
  <div class="menu-overlay" id="menuOverlay">
    <div class="menu-sidebar">
      <div class="menu-item" onclick="openProfileModal()">üë§ Hesabƒ±m / Profil</div>
      <div class="menu-item">‚öôÔ∏è Ayarlar</div>
      <div class="menu-item" style="color:var(--gold)">‚ÑπÔ∏è Caynana v7.5</div>
    </div>
  </div>

  <div class="modal-overlay" id="profileModal">
    <div class="profile-card">
      <button class="close-modal-btn" id="modalCloseBtn" onclick="closeProfileModal()">‚úï</button>
      
      <div class="p-header">
        <img id="pAvatar" class="p-avatar" src="https://via.placeholder.com/100" alt="Avatar">
        <div class="p-title">Profil Ayarlarƒ±</div>
        <div class="p-desc">Caynana seni daha iyi tanƒ±sƒ±n</div>
      </div>

      <div class="form-group">
        <label class="form-label">Google Adƒ± (Kimlik)</label>
        <input type="text" id="pFullname" class="form-input" disabled value="Misafir Kullanƒ±cƒ±">
      </div>

      <div class="form-group">
        <label class="form-label">Caynana Sana Ne Desin? (ZORUNLU)</label>
        <input type="text" id="pHitap" class="form-input" maxlength="12" placeholder="√ñrn: Aslanƒ±m, Kuzum, Reis">
      </div>

      <div class="form-group">
        <label class="form-label">Medeni Durum (ƒ∞steƒüe Baƒülƒ±)</label>
        <select id="pStatus" class="form-select">
          <option value="Bekar">Bekar</option>
          <option value="Evli">Evli</option>
        </select>
      </div>

      <button class="save-btn" onclick="saveProfile()">
        üíæ KAYDET VE BA≈ûLA
      </button>
    </div>
  </div>

  <div class="topbar">
    <div class="left-controls">
      <button class="hamb-btn" id="hambBtn">‚ò∞</button>
    </div>
    <div class="brand-wrapper" id="brandWrapper">
      <div class="logo-area">
        <svg class="seesaw-svg" viewBox="0 0 40 20">
          <polygon points="17,14 23,14 20,8" fill="none" stroke="#666" stroke-width="1.5" />
          <g class="seesaw-bar" id="seesawBar">
             <line x1="0" y1="8" x2="40" y2="8" stroke="#ccc" stroke-width="2" stroke-linecap="round" />
             <circle cx="3" cy="5" r="3" fill="#bef264" />
             <circle cx="37" cy="5" r="3" fill="#ffb300" />
          </g>
        </svg>
        <div class="brand-name">Caynana AI</div>
      </div>
      <div class="slogan">ƒ∞li≈ükisel Asistan v7.5</div>
    </div>
  </div>

  <div class="face-container">
    <div class="face-panel-inner" id="faceInner">
      <div class="eyes-row">
        <div class="eye" id="eyeL">
          <div class="brow"></div>
          <div class="sclera"><div class="iris"><div class="pupil"></div><div class="reflection"></div></div></div>
          <div class="lid-top"></div><div class="lid-bot"></div>
        </div>
        <div class="eye" id="eyeR">
          <div class="brow"></div>
          <div class="sclera"><div class="iris"><div class="pupil"></div><div class="reflection"></div></div></div>
          <div class="lid-top"></div><div class="lid-bot"></div>
        </div>
      </div>
      <div class="mouth-wrapper"><div class="mouth"></div></div>
      <button class="close-track-btn" id="closeTrackBtn">Takibi Kapat</button>
    </div>
  </div>

  <div class="chat-area" id="chat">
    <div class="bubble bot">G√∂z√ºm √ºzerinde... √ñnce bi tanƒ±≈üalƒ±m, sen kimsin?</div>
  </div>

  <div class="input-dock">
    <div class="track-trigger-row">
      <button class="main-track-btn" id="openTrackBtn">üëÅÔ∏è TAKƒ∞P ET</button>
    </div>
    <div class="dock-inner">
      <button class="icon-btn" id="camBtn">
        <svg viewBox="0 0 24 24"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>
      </button>
      <textarea id="msgInput" rows="1" placeholder="Ne lazƒ±m evladƒ±m?"></textarea>
      <button class="icon-btn" id="micBtn">
        <svg viewBox="0 0 24 24"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>
      </button>
      <button class="send-btn" id="sendBtn">
        <svg viewBox="0 0 24 24"><path d="M22 2L11 13"></path><path d="M22 2L15 22L11 13L2 9L22 2Z"></path></svg>
      </button>
    </div>
    <div class="footer">@CaynanAI Relational Edition</div>
  </div>
</div>

<video id="camVideo" autoplay playsinline muted></video>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>

<script>
  // DOM Elements (Mevcutlar)
  const frame = document.getElementById('mobileFrame');
  const chat = document.getElementById('chat');
  const msgInput = document.getElementById('msgInput');
  const eyeL = document.getElementById('eyeL');
  const eyeR = document.getElementById('eyeR');
  const brandWrapper = document.getElementById('brandWrapper');
  const openTrackBtn = document.getElementById('openTrackBtn');
  const closeTrackBtn = document.getElementById('closeTrackBtn');
  const camBtn = document.getElementById('camBtn');
  const micBtn = document.getElementById('micBtn');
  const sendBtn = document.getElementById('sendBtn');
  const camVideo = document.getElementById('camVideo');
  const menuOverlay = document.getElementById('menuOverlay');
  const hambBtn = document.getElementById('hambBtn');
  
  // PROFIL DOM
  const profileModal = document.getElementById('profileModal');
  const modalCloseBtn = document.getElementById('modalCloseBtn');
  const pAvatar = document.getElementById('pAvatar');
  const pFullname = document.getElementById('pFullname');
  const pHitap = document.getElementById('pHitap');

  // STATE
  let currentUser = null; // Kullanƒ±cƒ± objesi

  // --- INIT (BA≈ûLANGI√á KONTROL√ú) ---
  document.addEventListener('DOMContentLoaded', () => {
    // 1. LocalStorage'dan kullanƒ±cƒ±yƒ± √ßek
    const rawData = localStorage.getItem("caynana_user");
    
    if(rawData) {
      currentUser = JSON.parse(rawData);
      console.log("Kullanƒ±cƒ± bulundu:", currentUser.hitap);
      // Avatarƒ± g√ºncelle (Google sim√ºlasyonu)
      pAvatar.src = currentUser.avatar || "https://ui-avatars.com/api/?name=" + (currentUser.fullname || "User");
      
      // ƒ∞lk Kar≈üƒ±lama (ƒ∞simle)
      addBubble(`Tekrar ho≈ü geldin ${currentUser.hitap}.`, 'bot');
    } else {
      // 2. Kullanƒ±cƒ± yoksa ZORUNLU MODAL A√á
      console.log("Kullanƒ±cƒ± yok, profil olu≈üturulmalƒ±.");
      // Google Login Sim√ºlasyonu (Burada ger√ßekte Google'dan veri gelir)
      const googleSim = {
        fullname: "Yeni Kullanƒ±cƒ±",
        avatar: "https://lh3.googleusercontent.com/a/default-user"
      };
      
      // Formu doldur
      pFullname.value = googleSim.fullname;
      pAvatar.src = googleSim.avatar;
      
      // Modalƒ± A√ß (Kapatma butonunu gizle ki zorunlu olsun)
      modalCloseBtn.style.display = 'none'; 
      openProfileModal();
    }
  });

  // --- PROFIL MODAL ƒ∞≈ûLEMLERƒ∞ ---
  function openProfileModal() {
    profileModal.classList.add('open');
    menuOverlay.classList.remove('open'); // Yan men√º a√ßƒ±ksa kapat
  }
  
  function closeProfileModal() {
    // Eƒüer profil tamamlanmamƒ±≈üsa kapatamasƒ±n
    if(!currentUser) return alert("√ñnce profilini kaydetmelisin evladƒ±m!");
    profileModal.classList.remove('open');
  }

  function saveProfile() {
    const hitap = pHitap.value.trim();
    if(!hitap) return alert("Caynana sana ne desin? Bo≈ü bƒ±rakma.");

    // Kullanƒ±cƒ±yƒ± Olu≈ütur / G√ºncelle
    const newUser = {
      fullname: pFullname.value,
      avatar: pAvatar.src,
      hitap: hitap,
      status: document.getElementById('pStatus').value,
      profile_completed: true,
      last_seen: new Date().toISOString()
    };

    localStorage.setItem("caynana_user", JSON.stringify(newUser));
    currentUser = newUser;
    
    // UI G√ºncelle
    modalCloseBtn.style.display = 'block'; // Artƒ±k kapatabilir
    closeProfileModal();

    // Tanƒ±≈üma Mesajƒ±
    addBubble(`Memnun oldum ${hitap}. Artƒ±k seni tanƒ±yorum.`, 'bot');
    speakAndType(`Memnun oldum ${hitap}.`);
  }

  // --- MEVCUT JS KODLARI (Aynen Korundu - √ñzetlendi) ---
  // (Burada √∂nceki kodun State Machine, G√∂z Takibi, Sohbet Logic kƒ±sƒ±mlarƒ± aynen duruyor varsay.)
  // Tek fark: `processQuery` i√ßinde artƒ±k `currentUser.hitap` kullanƒ±labilir.

  // State
  let isTracking = false;
  let isCameraOn = false;
  let faceMesh, camera;
  let currentState = 'IDLE';

  // ... (G√∂z Fonksiyonlarƒ±, FaceMesh, √úr√ºn DB vb. buraya gelecek - Yer tasarrufu i√ßin tekrar yazmadƒ±m ama hepsi v7.0 ile aynƒ±) ...

  // Hamburger Men√º
  hambBtn.addEventListener('click', ()=>menuOverlay.classList.add('open'));
  menuOverlay.addEventListener('click', (e)=>{
    if(e.target === menuOverlay) menuOverlay.classList.remove('open');
  });

  // Chat Helpers (Required for init message)
  const scrollChat = () => chat.scrollTop = chat.scrollHeight;
  function addBubble(txt, type) {
    const d = document.createElement('div'); d.className = `bubble ${type}`; d.innerText = txt; 
    chat.appendChild(d); scrollChat(); 
  }
  
  // Fake Speak (Hata vermesin diye)
  async function speakAndType(text) {
     const synth = window.speechSynthesis;
     const u = new SpeechSynthesisUtterance(text);
     u.lang='tr-TR';
     synth.speak(u);
  }

  // ... Diƒüer t√ºm v7.0 fonksiyonlarƒ± burada ...
</script>
</body>
</html>
