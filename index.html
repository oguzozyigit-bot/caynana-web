<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=resizes-content" />
<title>Caynana AI v2.7 Final</title>
<link rel="icon" href="data:,">
<script src="https://accounts.google.com/gsi/client" async defer></script>

<style>
  :root{
    --bg-outer:#000; --bg:#0e0e0e; --text:#e6e6e6;
    --gold:#ffb300; --pistachio:#bef264; --glass:rgba(20,20,20,.98);
    --border:rgba(255,255,255,.12); --lip-color:#d84315; --card-bg:#1a1a1a;
    --muted:#8a8a8a; --muted2:#6f6f6f;
  }
  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  body,html{margin:0;padding:0;width:100%;height:100dvh;background:var(--bg-outer);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;color:var(--text);overflow:hidden;display:flex;align-items:center;justify-content:center}
  .mobile-frame{width:100%;height:100%;max-width:480px;background:var(--bg);position:relative;display:flex;flex-direction:column;box-shadow:0 0 50px rgba(255,255,255,.05);overflow:hidden}
  @media(min-width:500px){.mobile-frame{height:95dvh;border-radius:24px;border:1px solid #333}}

  /* TOPBAR */
  .topbar{
    flex:0 0 76px;background:var(--glass);border-bottom:1px solid var(--border);
    display:flex;align-items:center;padding:0 12px;z-index:3000;gap:10px;
  }

  /* ‚úÖ Sol ve saƒü kolon e≈üit geni≈ülik -> marka tam ortalanƒ±r */
  .left-controls{
    display:flex;gap:10px;align-items:center;flex:0 0 auto;
    min-width:112px;justify-content:flex-start;
  }
  .hamb-btn{background:none;border:none;cursor:pointer;color:#9a9a9a;font-size:24px;padding:0}

  /* Center brand */
  .brand-wrapper{
    display:flex;flex-direction:column;align-items:center;justify-content:center;
    flex:1;transition:transform .4s cubic-bezier(.175,.885,.32,1.275);
    text-align:center;
  }
  .logo-area{display:flex;align-items:center;gap:10px;justify-content:center}
  .brand-name{font-weight:800;font-size:16px;color:#fff}
  .slogan{font-size:11px;color:#7b7b7b;margin-top:2px;font-weight:600;letter-spacing:.5px}

  /* Eyes */
  .eyes{
    position:relative;display:flex;gap:8px;align-items:center;justify-content:center;
    width:44px;height:18px;
  }
  .eye{
    width:18px;height:18px;border-radius:999px;background:#121212;border:1px solid #2a2a2a;
    position:relative;overflow:hidden;
    box-shadow:inset 0 0 0 1px rgba(255,255,255,.03);
  }
  .pupil{
    width:6px;height:6px;border-radius:999px;background:#d9d9d9;
    position:absolute;left:6px;top:6px;
    transform:translate(0,0);
    transition:transform .12s ease;
  }
  .lid{
    position:absolute;left:0;right:0;top:0;height:0%;
    background:#0b0b0b;
    border-bottom:1px solid rgba(255,255,255,.06);
    transition:height .16s ease;
    pointer-events:none;
  }
  .eyes.blink .lid{height:100%}
  .eyes.sleep .pupil{opacity:0}
  .eyes.sleep .lid{height:100%}
  .eyes.drowse .lid{height:40%}

  .seesaw-svg{width:36px;height:18px;overflow:visible}
  .seesaw-bar{transform-origin:20px 8px;transition:transform .25s ease}

  /* ‚úÖ Tahteravalli davranƒ±≈üƒ± (artƒ±k saƒüda da √ßalƒ±≈üsƒ±n) */
  .brand-wrapper.usering .seesaw-bar,
  .caynana-gfx.usering .seesaw-bar{transform:rotate(-12deg)}
  .brand-wrapper.botting .seesaw-bar,
  .caynana-gfx.botting .seesaw-bar{transform:rotate(12deg)}
  .brand-wrapper.thinking .seesaw-bar,
  .caynana-gfx.thinking .seesaw-bar{animation:wiggle .35s infinite alternate ease-in-out}
  .brand-wrapper.talking  .seesaw-bar,
  .caynana-gfx.talking  .seesaw-bar{animation:wiggle .35s infinite alternate ease-in-out}

  @keyframes wiggle{from{transform:rotate(-10deg)}to{transform:rotate(10deg)}}

  .brand-wrapper.thinking #orangeBall,
  .caynana-gfx.thinking #orangeBall{
    animation:breath .8s infinite alternate ease-in-out;
    transform-box:fill-box;transform-origin:center
  }
  @keyframes breath{from{transform:scale(1);filter:brightness(1)}to{transform:scale(1.5);filter:brightness(1.3)}}

  /* Right stack */
  .right-stack{
    flex:0 0 auto;
    display:flex;flex-direction:column;align-items:flex-end;justify-content:center;
    gap:6px;min-width:112px;
  }

  /* ‚úÖ Saƒü tarafa ta≈üƒ±nan Caynana grafiƒüi */
  .caynana-gfx{
    display:flex;align-items:center;justify-content:flex-end;
    width:112px; /* hizalama i√ßin */
    margin-bottom:2px;
  }

  /* YP */
  .yp-chip{
    display:flex;align-items:center;gap:8px;padding:5px 9px;border:1px solid #2a2a2a;background:#151515;border-radius:999px;
  }
  .yp-label{font-size:9.5px;color:#7a7a7a;font-weight:900;letter-spacing:.7px}
  .yp-meter{width:66px;height:7px;border-radius:999px;background:#222;border:1px solid #333;overflow:hidden}
  .yp-fill{height:100%;width:50%;background:linear-gradient(90deg,#ff5252,#ffb300,#bef264)}
  .yp-num{font-size:10.5px;color:#cfcfcf;font-weight:900;min-width:34px;text-align:right}

  /* NOTIF */
  .notif-row{position:relative;display:flex;align-items:center;gap:8px}
  .notif-btn{background:none;border:none;position:relative;cursor:pointer;padding:4px;display:flex;align-items:center}
  .notif-btn svg{width:22px;height:22px;stroke:#9a9a9a;fill:none;stroke-width:2;transition:.2s}
  .notif-btn:active svg{stroke:var(--pistachio)}
  .badge{position:absolute;top:2px;right:2px;width:8px;height:8px;background:#ff5252;border-radius:50%;display:none;border:1px solid #000}
  .notification-dropdown{
    position:absolute;top:36px;right:0;width:300px;background:#1c1c1c;border:1px solid #333;border-radius:12px;
    box-shadow:0 10px 40px rgba(0,0,0,.5);z-index:4000;display:none;flex-direction:column;overflow:hidden;animation:slideDown .2s ease
  }
  .notification-dropdown.show{display:flex}
  @keyframes slideDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
  .notif-header{padding:12px;border-bottom:1px solid #333;font-size:13px;font-weight:900;color:#fff;background:#222}
  .notif-list{max-height:300px;overflow-y:auto}
  .notif-list::-webkit-scrollbar{width:0;height:0}
  .notif-item{padding:12px;border-bottom:1px solid #2a2a2a;display:flex;gap:10px;align-items:start}
  .notif-item:last-child{border-bottom:none}
  .notif-icon{font-size:18px}
  .notif-content{flex:1}
  .notif-title{font-size:13px;color:#fff;font-weight:700;margin-bottom:2px}
  .notif-desc{font-size:11px;color:#a0a0a0;line-height:1.3}

  /* Profil ikonu */
  .profile-btn{width:34px;height:34px;border-radius:12px;border:1px solid #333;background:#151515;display:flex;align-items:center;justify-content:center;cursor:pointer}
  .profile-btn svg{width:18px;height:18px;stroke:#9a9a9a;fill:none;stroke-width:2}
  .profile-btn:active svg{stroke:var(--gold)}

  /* CHAT */
  .chat-area{flex:1;overflow-y:auto;padding:18px 16px;display:flex;flex-direction:column;gap:14px;scroll-behavior:smooth;scrollbar-width:none}
  .chat-area::-webkit-scrollbar{display:none}
  .bubble{max-width:85%;padding:12px 14px;border-radius:18px;font-size:15px;line-height:1.4;word-wrap:break-word;flex-shrink:0;animation:pop .2s ease}
  .bubble.bot{align-self:flex-start;background:#1c1c1c;border-left:3px solid var(--gold);color:#dedede;border-top-left-radius:4px;min-height:40px;position:relative}
  .bubble.user{align-self:flex-end;background:#222;border-right:3px solid var(--pistachio);color:#fff;border-top-right-radius:4px;text-align:right}
  @keyframes pop{from{transform:scale(.98);opacity:.6}to{transform:scale(1);opacity:1}}

  /* ‚úÖ Beklerken turuncu √ßizgi yava≈ü dolsun */
  .bubble.bot.loading{opacity:.95}
  .bubble.bot.loading::before{
    content:"";
    position:absolute;
    left:-3px; top:0;
    width:3px; height:0%;
    background:var(--gold);
    border-radius:3px;
    animation:loadFill 1.6s ease-in-out infinite;
  }
  @keyframes loadFill{
    0%{height:0%}
    60%{height:100%}
    100%{height:100%}
  }

  /* DOCK (‚úÖ biraz daralt) */
  .input-dock{
    flex:0 0 auto;background:var(--glass);padding:4px 10px 6px;z-index:3000;border-top:1px solid var(--border);
    display:flex;flex-direction:column;gap:6px
  }
  .dock-inner{
    display:flex;align-items:flex-end;gap:8px;background:#171717;border:1px solid #2f2f2f;border-radius:18px;padding:3px 6px;
  }
  .icon-btn{width:38px;height:38px;border-radius:50%;border:none;background:transparent;display:flex;align-items:center;justify-content:center;cursor:pointer;flex-shrink:0;transition:.2s}
  .icon-btn svg{width:20px;height:20px;stroke:#9a9a9a;stroke-width:2;fill:none;transition:.2s}
  .icon-btn:hover svg,.icon-btn.active svg{stroke:var(--gold)}
  .icon-btn.active{background:rgba(255,179,0,.15)}
  .send-btn{width:38px;height:38px;border-radius:50%;background:var(--pistachio);color:#000;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:.2s;box-shadow:0 4px 10px rgba(190,242,100,.26)}
  .send-btn svg{stroke:#000;fill:none;width:20px;height:20px}
  textarea{
    flex:1;background:transparent;border:none;outline:none;color:#fff;font-size:15px;resize:none;
    padding:6px 6px;max-height:60px;min-height:20px;font-family:inherit;scrollbar-width:none
  }

  /* FOOTER */
  .footer-container{
    text-align:center;width:100%;
    padding:8px 0 10px;background:transparent;border-top:1px solid #151515
  }
  .footer-links{display:flex;justify-content:center;gap:12px;margin:4px 0 6px;flex-wrap:wrap}
  .footer-links a{color:#6f6f6f;text-decoration:none;font-size:11px}
  .footer-links a:hover{color:var(--gold)}
  .footer-brand{font-size:12px;color:#8c8c8c;font-weight:900;letter-spacing:.4px;margin-top:2px}
  .footer-year{font-size:12px;color:#6f6f6f;font-weight:900;margin-top:4px}
  .footer-ver-inline{font-size:10px;color:#5f5f5f;font-family:monospace;margin-left:6px}

  /* LOGIN */
  .full-overlay{position:absolute;inset:0;background:#000;z-index:6000;display:flex;flex-direction:column;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:.4s ease;padding:20px;overflow-y:auto}
  .full-overlay.active{opacity:1;pointer-events:auto}
  .login-card{width:100%;max-width:320px;text-align:center;display:flex;flex-direction:column;gap:15px;margin:auto}
  .login-logo{font-size:28px;font-weight:900;color:#fff;margin-bottom:5px}
  .login-logo span{color:var(--gold)}
  .auth-btn{width:100%;padding:12px;border-radius:12px;border:none;font-size:14px;font-weight:800;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;transition:.2s;opacity:.5;pointer-events:none;filter:grayscale(1);margin-bottom:8px}
  .auth-btn.enabled{opacity:1;pointer-events:auto;filter:grayscale(0)}
  .btn-google{background:#fff;color:#333;border:1px solid #ddd}
  .btn-apple{background:#000;color:#fff;border:1px solid #333}
  .auth-icon{width:20px;height:20px}
  .agreement-box{display:flex;align-items:center;gap:10px;font-size:12px;color:#888;justify-content:center;margin-top:10px;text-align:left}
  .agreement-box input{width:18px;height:18px;accent-color:var(--gold);cursor:pointer}
  .login-footer-links{margin-top:30px;display:flex;flex-wrap:wrap;justify-content:center;gap:12px;border-top:1px solid #222;padding-top:20px}
  .login-footer-links a{color:#666;font-size:11px;text-decoration:none;transition:.2s}
  .login-footer-links a:hover{color:var(--gold)}

  /* MENU */
  .menu-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:5000;opacity:0;pointer-events:none;transition:.3s;backdrop-filter:blur(5px);display:flex;justify-content:flex-start}
  .menu-overlay.open{opacity:1;pointer-events:auto}

  .menu-sidebar{
    width:270px;height:100%;background:#161616;padding:18px 16px 14px;
    transform:translateX(-100%);transition:.3s cubic-bezier(.4,0,.2,1);
    display:flex;flex-direction:column;border-right:1px solid #333;box-shadow:5px 0 30px rgba(0,0,0,.5);
    overflow-y:auto;
    scrollbar-width:none;
  }
  .menu-sidebar::-webkit-scrollbar{width:0;height:0}
  .menu-overlay.open .menu-sidebar{transform:translateX(0)}

  .sidebar-header{padding:12px 0 10px;border-bottom:1px solid #222;margin-bottom:10px}
  .new-chat-btn{width:100%;background:#333;color:var(--pistachio);border:1px solid #444;padding:12px;border-radius:10px;font-weight:900;cursor:pointer;text-align:center;margin-bottom:10px;display:flex;justify-content:center;align-items:center;gap:8px}
  .history-list{flex:0 0 auto;max-height:200px;overflow-y:auto;display:flex;flex-direction:column;gap:6px;margin-bottom:10px;padding-right:2px;scrollbar-width:none}
  .history-list::-webkit-scrollbar{width:0;height:0}
  .history-item{color:#cfcfcf;padding:10px 10px;border-radius:10px;font-size:13px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;transition:.2s;background:#121212;border:1px solid #222}
  .history-item:hover{background:#1d1d1d;color:#fff}
  .history-text{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:165px}
  .delete-chat-btn{background:none;border:none;color:#ff5252;cursor:pointer;font-size:16px;padding:0 6px}

  .menu-section-title{font-size:11px;color:#7a7a7a;font-weight:900;letter-spacing:.7px;padding:8px 4px 6px}
  .menu-grid{display:flex;flex-direction:column;gap:8px;margin-bottom:10px}
  .menu-action{
    display:flex;align-items:center;gap:10px;padding:10px 10px;border-radius:12px;border:1px solid #222;background:#121212;
    cursor:pointer;color:#d6d6d6;font-size:13px
  }
  .menu-action:hover{border-color:#333}
  .menu-action .ico{width:22px;text-align:center}
  .menu-action small{color:#7a7a7a;font-size:11px;display:block;margin-top:2px}

  .menu-footer-actions{margin-top:10px;padding-top:10px;border-top:1px solid #333}
  .menu-item{color:#bdbdbd;text-decoration:none;padding:10px 6px;display:block;font-size:13px;transition:.2s;cursor:pointer;border-radius:10px}
  .menu-item:hover{color:var(--gold);background:#121212}
  .danger{color:#ff5252}
  .danger:hover{background:rgba(255,82,82,.08)}
  .menu-brand{margin-top:10px;text-align:center;color:#8a8a8a;font-weight:900;font-size:12px;letter-spacing:.3px}
  .menu-year{margin-top:10px;text-align:center;color:#6f6f6f;font-weight:900;font-size:12px}

  #camVideo{display:none}
</style>
</head>

<body>
<div class="mobile-frame" id="mobileFrame">

  <!-- LOGIN -->
  <div class="full-overlay active" id="loginOverlay">
    <div class="login-card">
      <div style="display:flex; justify-content:center; margin-bottom:10px;">
        <svg class="seesaw-svg" viewBox="0 0 40 20" style="width:60px; height:30px;">
          <polygon points="17,14 23,14 20,8" fill="none" stroke="#666" stroke-width="1.5" />
          <g class="seesaw-bar">
            <line x1="0" y1="8" x2="40" y2="8" stroke="#ccc" stroke-width="2" stroke-linecap="round" />
            <circle cx="3" cy="5" r="3" fill="#bef264" />
            <circle cx="37" cy="5" r="3" fill="#ffb300" id="orangeBall" />
          </g>
        </svg>
      </div>

      <div class="login-logo">Caynana<span>.AI</span></div>
      <div style="font-size:13px; color:#777;">Yapay Zek√¢nƒ±n Geleneksel Aklƒ±</div>
      <br>

      <div style="border-bottom:1px solid #333; padding-bottom:15px; margin-bottom:15px;">
        <div style="font-size:11px; color:#666; margin-bottom:8px; text-transform:uppercase; letter-spacing:1px;">Devam Et</div>

        <button class="auth-btn btn-google enabled" id="googleLoginBtn" type="button">
          <svg class="auth-icon" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
          Google ile Devam Et
        </button>

        <button class="auth-btn btn-apple enabled" id="appleLoginBtn" type="button">
          <svg class="auth-icon" viewBox="0 0 24 24" fill="#fff"><path d="M17.05 20.28c-.98.95-2.05.88-3.08.4-1.09-.5-2.08-.48-3.24.02-1.44.62-2.2.44-3.06-.4C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.74s2.57-.91 4.35-.68c.75.04 2.86.32 3.9 1.83-3.23 1.6-2.67 6.38 1.02 7.94-.75 1.49-1.81 2.97-2.89 4.01l-.22.25-.24-.12zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.54 4.33-3.74 4.25z"/></svg>
          Apple ile Devam Et
        </button>
      </div>

      <div class="login-footer-links">
        <a href="pages/hakkimizda.html">Hakkƒ±mƒ±zda</a>
        <a href="pages/sss.html">SSS</a>
        <a href="pages/gizlilik.html">Gizlilik</a>
        <a href="pages/sozlesme.html">Kullanƒ±m</a>
        <a href="pages/iletisim.html">ƒ∞leti≈üim</a>
      </div>

      <div style="margin-top:20px; border-top:1px solid #222; padding-top:15px;">
        <div style="font-weight:900; color:#7f7f7f; font-size:12px;">@CaynanaAI By Ozyigits</div>
      </div>
    </div>
  </div>

  <!-- TERMS -->
  <div class="full-overlay" id="termsOverlay" style="z-index:6500; background:#000;">
    <div class="login-card" style="max-width:420px;">
      <div class="login-logo">S√∂zle≈üme<span>.Onay</span></div>
      <div style="font-size:12px; color:#777; line-height:1.5;">
        Devam etmek i√ßin s√∂zle≈ümeyi onaylaman gerekiyor evladƒ±m.
      </div>

      <div style="border:1px solid #222; border-radius:12px; overflow:hidden; height:320px; background:#111;">
        <iframe src="pages/sozlesme.html" style="width:100%; height:100%; border:0;"></iframe>
      </div>

      <div class="agreement-box" style="justify-content:flex-start; gap:10px;">
        <input type="checkbox" id="termsCheck">
        <label for="termsCheck" style="color:#aaa;">Okudum, onaylƒ±yorum.</label>
      </div>

      <button class="auth-btn btn-google enabled" style="filter:none; opacity:1;" id="termsAcceptBtn" type="button">
        ‚úÖ Onayla ve Devam Et
      </button>
    </div>
  </div>

  <!-- MENU -->
  <div id="menuMount">
    <div class="menu-overlay" id="menuOverlay">
      <div class="menu-sidebar">

        <div class="sidebar-header">
          <button class="new-chat-btn" id="newChatBtn" type="button"><span>+</span> Yeni Sohbet Ba≈ülat</button>
          <div style="font-size:11px; color:#666; padding-left:6px; margin-top:6px;">SON 5 SOHBET</div>
        </div>

        <div class="history-list" id="historyList"></div>

        <div class="menu-section-title">Men√º</div>
        <div class="menu-grid" id="mainMenu">
          <div class="menu-action" data-action="shopping"><div class="ico">üõçÔ∏è</div><div><div>Alƒ±≈üveri≈ü</div><small>Paranƒ± √ßar√ßur etme</small></div></div>
          <div class="menu-action" data-action="translate"><div class="ico">üåç</div><div><div>Terc√ºman</div><small>√áevir / d√ºzelt</small></div></div>
          <div class="menu-action" data-action="diet"><div class="ico">ü•ó</div><div><div>Diyet</div><small>Bug√ºn ne yiyeceƒüiz</small></div></div>
          <div class="menu-action" data-action="health"><div class="ico">ü©∫</div><div><div>Saƒülƒ±k</div><small>Genel danƒ±≈üma</small></div></div>
          <div class="menu-action" data-action="special"><div class="ico">üéâ</div><div><div>√ñzel G√ºn</div><small>Hatƒ±rlatmalar</small></div></div>
          <div class="menu-action" data-action="fal"><div class="ico">‚òï</div><div><div>Kahve Falƒ±</div><small>G√ºnde 1 kez</small></div></div>
          <div class="menu-action" data-action="tarot"><div class="ico">üÉè</div><div><div>Tarot</div><small>Kart se√ßelim</small></div></div>
          <div class="menu-action" data-action="horoscope"><div class="ico">‚ôà</div><div><div>Bur√ß</div><small>G√ºnl√ºk yorum</small></div></div>
          <div class="menu-action" data-action="dream"><div class="ico">üåô</div><div><div>R√ºya Tabiri</div><small>Ne g√∂rd√ºn anlat</small></div></div>
          <!-- Regl takibi (kadƒ±nsa) JS ile eklenecek -->
        </div>

        <div class="menu-footer-actions">
          <a class="menu-item" id="logoutBtn">üõ°Ô∏è G√ºvenli √áƒ±kƒ±≈ü</a>
          <a class="menu-item danger" id="deleteAccountBtn">üóëÔ∏è Hesabƒ±mƒ± Sil</a>

          <div class="menu-brand">@caynana By Ozyigits</div>
          <div class="menu-year">2026</div>
        </div>

      </div>
    </div>
  </div>

  <!-- TOPBAR -->
  <div class="topbar">
    <div class="left-controls">
      <button class="hamb-btn" id="hambBtn" type="button">‚ò∞</button>
    </div>

    <div class="brand-wrapper" id="brandWrapper">
      <div class="logo-area">
        <div class="eyes" id="eyes">
          <div class="eye"><div class="lid"></div><div class="pupil" data-eye="l"></div></div>
          <div class="eye"><div class="lid"></div><div class="pupil" data-eye="r"></div></div>
        </div>

        <!-- ‚úÖ Seesaw buradan kaldƒ±rƒ±ldƒ± (saƒü tarafa ta≈üƒ±ndƒ±) -->

        <div class="brand-name">Caynana AI</div>
      </div>
      <div class="slogan">Yapay Zek√¢nƒ±n Geleneksel Aklƒ±</div>
    </div>

    <div class="right-stack">
      <!-- ‚úÖ Caynana grafiƒüi bildirim+profilin √ºst√ºnde -->
      <div class="caynana-gfx" id="caynanaGfx" aria-hidden="true">
        <svg class="seesaw-svg" viewBox="0 0 40 20" style="width:44px;height:22px;overflow:visible">
          <polygon points="17,14 23,14 20,8" fill="none" stroke="#666" stroke-width="1.5" />
          <g class="seesaw-bar" id="seesawBar">
            <line x1="0" y1="8" x2="40" y2="8" stroke="#ccc" stroke-width="2" stroke-linecap="round" />
            <circle cx="3" cy="5" r="3" fill="#bef264" />
            <circle cx="37" cy="5" r="3" fill="#ffb300" id="orangeBall" />
          </g>
        </svg>
      </div>

      <div class="yp-chip" title="Samimiyet (YP)">
        <div class="yp-label">SAMƒ∞Mƒ∞</div>
        <div class="yp-meter"><div class="yp-fill" id="ypFill"></div></div>
        <div class="yp-num" id="ypNum">50%</div>
      </div>

      <div class="notif-row" id="notifMount">
        <button class="notif-btn" id="notifBtn" type="button" title="Bildirimler">
          <svg viewBox="0 0 24 24"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
          <div class="badge" id="notifBadge"></div>
        </button>

        <div class="notification-dropdown" id="notifDropdown">
          <div class="notif-header">Bildirimler</div>
          <div class="notif-list" id="notifList"></div>
        </div>

        <button class="profile-btn" id="profileBtn" type="button" title="Profil">
          <svg viewBox="0 0 24 24"><path d="M20 21a8 8 0 0 0-16 0"></path><circle cx="12" cy="7" r="4"></circle></svg>
        </button>
      </div>
    </div>
  </div>

  <!-- CHAT -->
  <div class="chat-area" id="chat"></div>

  <!-- DOCK -->
  <div class="input-dock">
    <div class="dock-inner">
      <button class="icon-btn" id="camBtn" type="button" title="Kamera">
        <svg viewBox="0 0 24 24"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>
      </button>

      <textarea id="msgInput" rows="1" placeholder="Ne lazƒ±m evladƒ±m?"></textarea>

      <button class="icon-btn" id="micBtn" type="button" title="Dikte">
        <svg viewBox="0 0 24 24"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>
      </button>

      <button class="send-btn" id="sendBtn" type="button" title="G√∂nder">
        <svg viewBox="0 0 24 24"><path d="M22 2L11 13"></path><path d="M22 2L15 22L11 13L2 9L22 2Z"></path></svg>
      </button>
    </div>
  </div>

  <!-- FOOTER -->
  <div class="footer-container">
    <div class="footer-links">
      <a href="pages/hakkimizda.html">Hakkƒ±mƒ±zda</a>
      <a href="pages/sss.html">SSS</a>
      <a href="pages/gizlilik.html">Gizlilik</a>
      <a href="pages/iletisim.html">ƒ∞leti≈üim</a>
    </div>
    <div class="footer-brand">@CaynanaAI By Ozyigits</div>
    <div class="footer-year">2026 <span class="footer-ver-inline">v2.7</span></div>
  </div>
</div>

<script type="module">
  // ‚úÖ MOBƒ∞L FIX: /js yerine ./js
  import { initPartials } from './js/partials.js';
  import { initNotif } from './js/notif.js';
  import { initAuth, handleLogin, logout, acceptTerms } from './js/auth.js';
  import { addUserBubble, fetchTextResponse, typeWriter as typeWriterLib } from './js/chat.js';
  import { BASE_DOMAIN, STORAGE_KEY } from './js/config.js';
  import { openFalPanel, closeFalPanel, handleFalPhoto } from './js/fal.js';

  const $ = (id) => document.getElementById(id);

  // ---------------------------
  // Mini Memory (lokal) - balƒ±k hafƒ±za fix
  // ---------------------------
  const MEM_KEY = "caynana_user_mem_v1";
  function loadMem(){ try{return JSON.parse(localStorage.getItem(MEM_KEY)||"{}");}catch{return {};} }
  function saveMem(m){ localStorage.setItem(MEM_KEY, JSON.stringify(m||{})); }

  function learnFromText(t){
    const s = (t||"").toLowerCase();
    const m = loadMem();

    // "ben d√ºzcedeyim" / "d√ºzce'deyim"
    const cityMatch =
      s.match(/\bben\s+([a-z√ßƒüƒ±√∂≈ü√º]+)(?:'|‚Äô)?deyim\b/i) ||
      s.match(/\b([a-z√ßƒüƒ±√∂≈ü√º]+)(?:'|‚Äô)?deyim\b/i);

    if(cityMatch && cityMatch[1]){
      m.city = cityMatch[1];
      saveMem(m);
    }
    return m;
  }

  // ---------------------------
  // YP (Samimiyet) Engine
  // ---------------------------
  const YP_KEY = "caynana_yp_v1";
  function clamp(n, lo=0, hi=100){ return Math.max(lo, Math.min(hi, n)); }
  function todayStr(){
    const d = new Date();
    return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
  }
  function daysBetween(aStr, bStr){
    const a = new Date(aStr + "T00:00:00");
    const b = new Date(bStr + "T00:00:00");
    return Math.floor((b - a) / 86400000);
  }
  function loadYP(){ try { return JSON.parse(localStorage.getItem(YP_KEY) || "{}"); } catch { return {}; } }
  function saveYP(obj){ localStorage.setItem(YP_KEY, JSON.stringify(obj)); }
  function getYP(){ const s = loadYP(); const yp = typeof s.yp === "number" ? s.yp : 50; return clamp(yp); }
  function renderYP(){
    const yp = getYP();
    const fill = $("ypFill");
    const num = $("ypNum");
    if(fill) fill.style.width = `${yp}%`;
    if(num) num.textContent = `${Math.round(yp)}%`;
  }
  function applyDailyYP(){
    const s = loadYP();
function applyDailyYP(){
  const s = loadYP();
  const today = todayStr();
  const lastSeen = s.last_seen_day || today;
  const missed = Math.max(0, daysBetween(lastSeen, today));

  // g√ºn ka√ßƒ±rdƒ±ysa d√º≈ü√ºr
  if(missed >= 1){
    const current = typeof s.yp === "number" ? s.yp : 50;
    s.yp = clamp(current - (10 * missed));
  }

  // g√ºnl√ºk bonus (aynƒ± g√ºn 1 kez)
  if(s.last_bonus_day !== today){
    const current = typeof s.yp === "number" ? s.yp : 50;
    s.yp = clamp(current + 5);
    s.last_bonus_day = today;
  }

  s.last_seen_day = today;
  saveYP(s);
  renderYP();
}

function addYP(delta){
  const s = loadYP();
  const current = typeof s.yp === "number" ? s.yp : 50;
  s.yp = clamp(current + delta);
  saveYP(s);
  renderYP();
}

// ---------------------------
// Chat Sessions (Son 5 sohbet)
// ---------------------------
const CHATS_KEY = "caynana_chats_v1";
let currentChatId = null;

function loadChats(){ try { return JSON.parse(localStorage.getItem(CHATS_KEY)||"[]"); } catch { return []; } }
function saveChats(arr){ localStorage.setItem(CHATS_KEY, JSON.stringify(arr)); }

function newChat(){
  const id = "c_" + Date.now();
  const chat = { id, title: "Yeni sohbet", msgs: [], updatedAt: Date.now() };
  const all = loadChats();
  all.unshift(chat);
  saveChats(all.slice(0, 30));
  currentChatId = id;
  $("chat").innerHTML = "";
  typeWriterLib("Sƒ±fƒ±rdan ba≈üladƒ±k evladƒ±m, buyur.", "chat");
  renderChatList();
}

function updateChatTitleFromFirstUser(chat){
  const firstUser = (chat.msgs || []).find(m => m.role === "user");
  if(firstUser){
    const t = (firstUser.content || "").trim().slice(0,10);
    chat.title = t || "Sohbet";
  }
}

function pushMsg(role, content){
  const all = loadChats();
  if(!all.length){
    const id = "c_" + Date.now();
    all.unshift({ id, title:"Yeni sohbet", msgs:[], updatedAt: Date.now() });
    currentChatId = id;
  }
  let chat = all.find(c => c.id === currentChatId) || all[0];
  currentChatId = chat.id;

  chat.msgs = chat.msgs || [];
  chat.msgs.push({ role, content, t: Date.now() });
  chat.updatedAt = Date.now();
  updateChatTitleFromFirstUser(chat);

  const rest = all.filter(c => c.id !== chat.id);
  const merged = [chat, ...rest].sort((a,b)=> (b.updatedAt||0)-(a.updatedAt||0));
  saveChats(merged.slice(0,30));
  renderChatList();
}

// ‚úÖ HISTORY BUILDER (SON 16 MESAJ) - (≈üimdilik local; backend entegrasyonu chat.js‚Äôde)
function buildHistoryForBackend(maxTurns = 16){
  const all = loadChats().sort((a,b)=> (b.updatedAt||0)-(a.updatedAt||0));
  const chat = all.find(c => c.id === currentChatId) || all[0];
  const msgs = (chat?.msgs || []).slice(-maxTurns);

  return msgs.map(m => ({
    role: (m.role === "assistant") ? "assistant" : "user",
    content: String(m.content || "")
  }));
}

function escapeHtml(s){
  return String(s||"").replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}

function renderChatList(){
  const list = $("historyList");
  if(!list) return;
  const all = loadChats().sort((a,b)=> (b.updatedAt||0)-(a.updatedAt||0));
  const top5 = all.slice(0,5);

  list.innerHTML = top5.map(c => `
    <div class="history-item" data-id="${c.id}">
      <div class="history-text">${escapeHtml(c.title || "Sohbet")}</div>
      <button class="delete-chat-btn" data-del="${c.id}" title="Sil">üóëÔ∏è</button>
    </div>
  `).join("");

  list.querySelectorAll(".history-item").forEach(el=>{
    el.addEventListener("click", (e)=>{
      const del = e.target?.getAttribute?.("data-del");
      if(del) return;
      const id = el.getAttribute("data-id");
      openChat(id);
    });
  });

  list.querySelectorAll("[data-del]").forEach(btn=>{
    btn.addEventListener("click", (e)=>{
      e.stopPropagation();
      const id = btn.getAttribute("data-del");
      deleteChat(id);
    });
  });
}

function openChat(id){
  const all = loadChats();
  const chat = all.find(c=>c.id===id);
  if(!chat) return;
  currentChatId = id;
  $("chat").innerHTML = "";
  (chat.msgs||[]).forEach(m=>{
    if(m.role==="user") addUserBubble(m.content);
    else typeWriterLib(m.content, "chat");
  });
  toggleMenu(false);
}

function deleteChat(id){
  const ok = confirm("Bu sohbet silinsin mi evladƒ±m?");
  if(!ok) return;
  const all = loadChats().filter(c=>c.id!==id);
  saveChats(all);
  if(currentChatId===id){
    currentChatId = all[0]?.id || null;
    $("chat").innerHTML = "";
  }
  renderChatList();
}

// ---------------------------
// Menu / Notif toggles
// ---------------------------
function toggleMenu(force){
  const el = $("menuOverlay");
  if(!el) return;
  if(typeof force==="boolean") el.classList.toggle("open", force);
  else el.classList.toggle("open");
}

function toggleNotif(force){
  const el = $("notifDropdown");
  if(!el) return;
  if(typeof force==="boolean") el.classList.toggle("show", force);
  else el.classList.toggle("show");
}

// ---------------------------
// Terms
// ---------------------------
async function acceptTermsAndEnter(){
  const cb = $("termsCheck");
  if(!cb || !cb.checked){ alert("Onay kutusunu i≈üaretle evladƒ±m."); return; }
  const ok = await acceptTerms();
  if(ok) enterApp();
  else alert("Onay kaydedilemedi evladƒ±m.");
}

function enterApp(){
  $("loginOverlay")?.classList.remove("active");
  $("termsOverlay")?.classList.remove("active");

  const user = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
  const name = user.fullname || user.email || "Evladƒ±m";

  setTimeout(()=> typeWriterLib(`Ho≈ü geldin ${name}. Ben Caynana.`, "chat"), 250);
  refreshNotifications?.();
}

// ---------------------------
// Notif fetch
// ---------------------------
async function refreshNotifications(){
  const list = $("notifList");
  const badge = $("notifBadge");
  if(!list) return;

  try{
    const user = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
    const res = await fetch(`${BASE_DOMAIN}/api/reminders/today?user_id=${encodeURIComponent(user.id || "guest")}`);
    const data = await res.json();
    const items = data.items || [];

    if(badge) badge.style.display = items.length ? "block" : "none";

    if(!items.length){
      list.innerHTML = `
        <div class="notif-item">
          <div class="notif-icon">üßø</div>
          <div class="notif-content">
            <div class="notif-title">Sakin</div>
            <div class="notif-desc">Hatƒ±rlatma yok evladƒ±m.</div>
          </div>
        </div>`;
      return;
    }

    list.innerHTML = items.map(it => `
      <div class="notif-item">
        <div class="notif-icon">üîî</div>
        <div class="notif-content">
          <div class="notif-title">${escapeHtml(it.title)}</div>
          <div class="notif-desc">${escapeHtml(it.message)}</div>
        </div>
      </div>
    `).join("");

  } catch(e){
    console.log("Notif error:", e);
  }
}

// ---------------------------
// Brand seesaw (logo + saƒüdaki grafiƒüi birlikte y√∂net)
// ---------------------------
function setBrandState(state){
  const b = $("brandWrapper");
  const g = $("caynanaGfx");
  if(b) b.classList.remove("usering","botting","thinking","talking");
  if(g) g.classList.remove("usering","botting","thinking","talking");
  if(state){
    if(b) b.classList.add(state);
    if(g) g.classList.add(state);
  }
}

// ---------------------------
// Eyes engine (blink / look / sleep + takip komutu)
// ---------------------------
const EYES = {
  asleep:false,
  drowsy:false,
  camOn:false,
  follow:false,
  lastActivity:Date.now(),
  target:{x:0.5,y:0.35},
  cur:{x:0.5,y:0.35},
  wanderTimer:null,
  blinkTimer:null,
  sleepTimer:null,
  raf:null
};

function setEyesClass(cls, on){
  const el = $("eyes");
  if(!el) return;
  if(on) el.classList.add(cls);
  else el.classList.remove(cls);
}

function hardWake(){
  EYES.asleep = false;
  EYES.drowsy = false;
  setEyesClass("sleep", false);
  setEyesClass("drowse", false);
  doBlink();
}

function markActivity(){
  EYES.lastActivity = Date.now();
  if(EYES.asleep || EYES.drowsy) hardWake();
}

function doBlink(){
  const el = $("eyes");
  if(!el) return;
  el.classList.add("blink");
  setTimeout(()=> el.classList.remove("blink"), 140);
}

async function goToSleepSequence(){
  if(EYES.asleep) return;
  const el = $("eyes");
  if(!el) return;

  EYES.drowsy = true;
  el.classList.add("drowse");

  doBlink(); await new Promise(r=>setTimeout(r, 420));
  doBlink(); await new Promise(r=>setTimeout(r, 520));
  doBlink(); await new Promise(r=>setTimeout(r, 520));

  EYES.asleep = true;
  EYES.drowsy = false;
  el.classList.remove("drowse");
  el.classList.add("sleep");
}

function setEyesTargetClientXY(clientX, clientY){
  const frame = $("mobileFrame");
  if(!frame) return;
  const r = frame.getBoundingClientRect();
  const nx = (clientX - r.left) / r.width;
  const ny = (clientY - r.top) / r.height;
  EYES.target.x = Math.max(0, Math.min(1, nx));
  EYES.target.y = Math.max(0, Math.min(1, ny));
}

function setEyesTargetToInput(){
  const input = $("msgInput");
  if(!input) return;
  const r = input.getBoundingClientRect();
  setEyesTargetClientXY(r.left + r.width*0.65, r.top + r.height*0.55);
}

function setEyesTargetWander(){
  const nx = 0.35 + Math.random()*0.3;
  const ny = 0.22 + Math.random()*0.22;
  EYES.target.x = nx;
  EYES.target.y = ny;
}

function tickEyes(){
  const el = $("eyes");
  if(!el){
    EYES.raf = requestAnimationFrame(tickEyes);
    return;
  }

  const idleMs = Date.now() - EYES.lastActivity;

  if(!EYES.asleep && idleMs > 30000){
    goToSleepSequence();
  } else if(!EYES.asleep && idleMs > 12000){
    if(!EYES.drowsy) { EYES.drowsy = true; el.classList.add("drowse"); }
  } else {
    if(EYES.drowsy){ EYES.drowsy=false; el.classList.remove("drowse"); }
  }

  if(EYES.camOn && !EYES.asleep){
    EYES.target.x = 0.5 + (Math.sin(Date.now()/900) * 0.03);
    EYES.target.y = 0.36 + (Math.cos(Date.now()/1200) * 0.03);
  }

  const sp = EYES.asleep ? 0.02 : 0.12;
  EYES.cur.x += (EYES.target.x - EYES.cur.x) * sp;
  EYES.cur.y += (EYES.target.y - EYES.cur.y) * sp;

  const dx = (EYES.cur.x - 0.5) * 10;
  const dy = (EYES.cur.y - 0.35) * 10;
  const px = Math.max(-6, Math.min(6, dx));
  const py = Math.max(-5, Math.min(5, dy));

  el.querySelectorAll(".pupil").forEach(p=>{
    p.style.transform = `translate(${px}px, ${py}px)`;
    p.style.opacity = EYES.asleep ? "0" : "1";
  });

  EYES.raf = requestAnimationFrame(tickEyes);
}

function initEyes(){
  const el = $("eyes");
  if(!el) return;

  const scheduleBlink = () => {
    const t = 2600 + Math.random()*4200;
    EYES.blinkTimer = setTimeout(()=>{
      if(!EYES.asleep) doBlink();
      scheduleBlink();
    }, t);
  };
  scheduleBlink();

  const scheduleWander = () => {
    const t = 1800 + Math.random()*2600;
    EYES.wanderTimer = setTimeout(()=>{
      if(!EYES.asleep && !EYES.camOn){
        const idleMs = Date.now() - EYES.lastActivity;
        if(idleMs < 2000) setEyesTargetToInput();
        else setEyesTargetWander();
      }
      scheduleWander();
    }, t);
  };
  scheduleWander();

  ["pointerdown","keydown","mousemove","touchstart"].forEach(evt=>{
    document.addEventListener(evt, (e)=>{
      markActivity();
      if(evt==="mousemove" && EYES.follow && !EYES.camOn && !EYES.asleep){
        setEyesTargetClientXY(e.clientX, e.clientY);
      }
    }, { passive:true });
  });

  $("msgInput")?.addEventListener("input", ()=>{
    markActivity();
    if(!EYES.camOn && !EYES.asleep) setEyesTargetToInput();
  });
  $("msgInput")?.addEventListener("focus", ()=>{
    markActivity();
    if(!EYES.camOn && !EYES.asleep) setEyesTargetToInput();
  });

  if(EYES.raf) cancelAnimationFrame(EYES.raf);
  EYES.raf = requestAnimationFrame(tickEyes);
}

// ---------------------------
// SEND (tek kaynak) + takip komutlarƒ± + mini memory + loading balon
// ---------------------------
async function doSend(forcedText=null){
  const inputEl = $("msgInput");
  const txt = (forcedText ?? inputEl?.value ?? "").trim();
  if(!txt) return;

  const low = txt.toLowerCase();

  // g√∂z takip komutlarƒ±
  if(low.includes("takip et")){
    EYES.follow = true;
    markActivity();
    doBlink();
    const ans = "Tamam evladƒ±m, g√∂z√ºm sende. üëÄ";
    pushMsg("assistant", ans);
    typeWriterLib(ans, "chat");
    return;
  }
  if(low.includes("takibi kapat") || low.includes("takip kapat")){
    EYES.follow = false;
    markActivity();
    doBlink();
    const ans = "Peki evladƒ±m, takibi kapattƒ±m.";
    pushMsg("assistant", ans);
    typeWriterLib(ans, "chat");
    return;
  }

  // mini memory √∂ƒüren
  learnFromText(txt);

  // "neredeyim" hƒ±zlƒ± cevap
  if(low.includes("ben neredeyim") || low.includes("neredeyim")){
    const m = loadMem();
    const ans = m.city ? `D√ºzce demi≈ütin evladƒ±m: ${m.city}.` : "Evladƒ±m daha s√∂ylemedin ki, neredesin?";
    pushMsg("assistant", ans);
    typeWriterLib(ans, "chat");
    return;
  }

  markActivity();

  // YP: her mesaj +0.5
  addYP(0.5);

  setBrandState("usering");
  setTimeout(()=> setBrandState("thinking"), 140);

  addUserBubble(txt);
  if(inputEl && forcedText==null) inputEl.value = "";

  pushMsg("user", txt);

  // loading balon
  const holder = document.createElement("div");
  holder.className = "bubble bot loading";
  holder.textContent = "‚Ä¶";
  $("chat")?.appendChild(holder);
  holder.scrollIntoView({behavior:"smooth", block:"end"});

  // backend‚Äôe k√º√ß√ºk baƒülam ekle (≈üehir)
  const m = loadMem();
  const ctx = m.city ? `(Kullanƒ±cƒ± bilgisi: Kullanƒ±cƒ± ${m.city} ≈üehrinde.)\n` : "";

  const out = await fetchTextResponse(ctx + txt, "chat");
  const reply = out?.text || "Evladƒ±m bir ≈üeyler ters gitti.";
  try{ holder.remove(); }catch(e){}

  setBrandState("botting");
  setTimeout(()=> setBrandState("talking"), 120);

  pushMsg("assistant", reply);
  typeWriterLib(reply, "chat");

  setTimeout(()=> setBrandState(null), 520);
}

// ---------------------------
// Delete account (3 confirm)
// ---------------------------
async function deleteAccountTriple(){
  if(!confirm("Hesabƒ±nƒ± silmek istiyor musun?")) return;
  if(!confirm("Emin misin? Geri d√∂n√º≈ü yok evladƒ±m.")) return;
  if(!confirm("Son kez soruyorum: HESABIN Sƒ∞Lƒ∞NECEK. Onaylƒ±yor musun?")) return;

  try{
    localStorage.removeItem(STORAGE_KEY);
    localStorage.removeItem(CHATS_KEY);
    localStorage.removeItem(YP_KEY);
    localStorage.removeItem(MEM_KEY);
  }catch(e){}

  alert("Tamamdƒ±r. Hesap verileri bu cihazdan silindi.");
  location.href = "/index.html";
}

// ---------------------------
// Kadƒ±nsa: Regl Takibi men√º ekle
// ---------------------------
function isFemaleProfile(){
  try{
    const user = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
    const g = (user.gender || user.sex || "").toString().toLowerCase();
    if(g.includes("kad") || g==="female" || g==="f") return true;

    const p = JSON.parse(localStorage.getItem("caynana_profile_v2") || "{}");
    const g2 = (p.gender || p.sex || "").toString().toLowerCase();
    return (g2.includes("kad") || g2==="female" || g2==="f");
  }catch(e){
    return false;
  }
}

function injectPeriodMenuIfNeeded(){
  const menu = $("mainMenu");
  if(!menu) return;
  if(!isFemaleProfile()) return;
  if(menu.querySelector('[data-action="period"]')) return;

  const div = document.createElement("div");
  div.className = "menu-action";
  div.setAttribute("data-action","period");
  div.innerHTML = `<div class="ico">ü©∏</div><div><div>Regl Takibi</div><small>D√∂ng√º / hatƒ±rlatma</small></div>`;
  menu.appendChild(div);

  div.addEventListener("click", ()=> handleMenuAction("period"));
}

// ---------------------------
// Menu actions
// ---------------------------
function handleMenuAction(action){
  toggleMenu(false);

  if(action==="fal"){ openFalPanel(); return; }
  if(action==="tarot"){ location.href="pages/tarot.html"; return; }
  if(action==="horoscope"){ location.href="pages/burc.html"; return; }
  if(action==="dream"){ location.href="pages/ruya.html"; return; }
  if(action==="translate"){ doSend("Terc√ºman: Metni yapƒ±≈ütƒ±r, dili s√∂yle (TR/EN/DE/AR vs)."); return; }

  if(action==="shopping"){ doSend("Alƒ±≈üveri≈ü moduna ge√ßelim: Ne almak istiyorsun?"); return; }
  if(action==="diet"){ doSend("Diyet: Bug√ºn hedefin nedir; kilo mu, koruma mƒ±?"); return; }
  if(action==="health"){ doSend("Saƒülƒ±k: Ne ≈üikayetin var evladƒ±m?"); return; }
  if(action==="special"){ doSend("√ñzel G√ºn: Hangi tarihleri hatƒ±rlatayƒ±m?"); return; }
  if(action==="period"){ location.href="pages/regl.html"; return; }
}

// ---------------------------
// Camera toggle (eyes follow)
// ---------------------------
function toggleCamEyes(on){
  EYES.camOn = !!on;
  markActivity();
}

// ---------------------------
// Boot
// ---------------------------
document.addEventListener("DOMContentLoaded", async () => {

  // 0) Eyes
  try { initEyes(); } catch(e){}

  // 1) AUTH (√ñNCE)
  if (typeof initAuth === "function") initAuth();

  // Login buttons
  $("googleLoginBtn")?.addEventListener("click", () => handleLogin("google"));
  $("appleLoginBtn")?.addEventListener("click", () => handleLogin("apple"));

  // 2) YP
  try { applyDailyYP(); } catch(e){}

  // 3) Partials & Notif
  try { await initPartials(); } catch(e){}
  try { initNotif({ baseUrl: BASE_DOMAIN }); } catch(e){}

  // 4) Profile
  $("profileBtn")?.addEventListener("click", () => location.href="pages/profil.html");

  // 5) Menu
  $("hambBtn")?.addEventListener("click", () => toggleMenu());
  $("menuOverlay")?.addEventListener("click", (e) => { if (e.target?.id === "menuOverlay") toggleMenu(false); });

  // 6) Notifications
  $("notifBtn")?.addEventListener("click", () => { toggleNotif(); refreshNotifications(); });
  document.addEventListener("click", (e) => {
    const dd = $("notifDropdown");
    const btn = $("notifBtn");
    if (!dd || !btn) return;
    if (dd.classList.contains("show") && !dd.contains(e.target) && !btn.contains(e.target)) dd.classList.remove("show");
  });

  // 7) Terms
  $("termsAcceptBtn")?.addEventListener("click", acceptTermsAndEnter);

  // 8) Chat send
  $("sendBtn")?.addEventListener("click", () => doSend());
  $("msgInput")?.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && !e.shiftKey) { e.preventDefault(); doSend(); }
    else markActivity();
  });

  // 9) New chat
  $("newChatBtn")?.addEventListener("click", () => newChat());

  // 10) Menu actions
  document.querySelectorAll(".menu-action").forEach(el => {
    el.addEventListener("click", () => handleMenuAction(el.getAttribute("data-action")));
  });

  // 11) Logout / Delete account
  $("logoutBtn")?.addEventListener("click", () => logout());
  $("deleteAccountBtn")?.addEventListener("click", deleteAccountTriple);

  // 12) Fal hooks
  window.openFal = openFalPanel;
  window.closeFal = closeFalPanel;
  window.handleFalFile = handleFalPhoto;

  // 13) Camera btn -> eyes follow mode
  $("camBtn")?.addEventListener("click", ()=>{
    toggleCamEyes(!EYES.camOn);
    if(!EYES.asleep) doBlink();
  });

  // 14) Session check
  const user = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");

  renderChatList();

  const chats = loadChats();
  if (chats.length && !currentChatId) {
    currentChatId = chats.sort((a,b)=>(b.updatedAt||0)-(a.updatedAt||0))[0]?.id || null;
  }

  injectPeriodMenuIfNeeded();

  if (user && user.isSessionActive && user.email) {
    $("loginOverlay")?.classList.remove("active");
    if (!user.terms_accepted_at) $("termsOverlay")?.classList.add("active");
    else enterApp();
  }

  if (!loadChats().length) newChat();

  refreshNotifications();
});
