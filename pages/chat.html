<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Caynana Sohbet</title>

  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="/css/style.css?v=2">
  <link rel="stylesheet" href="/css/layout-common.css?v=1">

  <style>
    /* =========================================
       CHAT ÖZEL LAYOUT (SCROLL FIX)
       ========================================= */
    :root {
      --bg-dark: #000000;
      /* Yükseklik Tanımları */
      --topH: 65px;     /* Üst Bar */
      --footerH: 64px;  /* En Alt Footer */
      --assistH: 70px;  /* İkon Barı */
      --dockH: 80px;    /* Yazı Alanı */
    }

    body, html { 
      background: var(--bg-dark); 
      height: 100%; 
      overflow: hidden; 
      margin: 0; padding: 0;
    }

    .mobile-frame {
      width: 100%; height: 100%; max-width: 480px; margin: 0 auto;
      background: var(--bg-dark); position: relative; display: flex; flex-direction: column;
    }

    /* 1. TOPBAR (SABİT) */
    .topbar {
      position: absolute; top: 0; left: 0; right: 0; height: var(--topH);
      background: rgba(0,0,0,0.95); z-index: 100;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 15px;
    }

    /* 2. CHAT ALANI (SCROLL BURADA ÇALIŞACAK) */
    .chat-area {
      position: absolute;
      top: 0; 
      left: 0; 
      right: 0; 
      bottom: 0;
      
      /* Kritik Ayarlar: */
      z-index: 10; /* Diğer barların altında */
      overflow-y: auto; /* Kaydırmayı aç */
      -webkit-overflow-scrolling: touch; /* Mobil akıcılık */
      
      display: flex;
      flex-direction: column;
      justify-content: flex-end; /* Mesajları aşağı it */
      gap: 12px;

      /* Mesajların barların altında kalmaması için iç boşluk */
      padding-top: 80px !important; 
      padding-bottom: 240px !important; /* Footer + Menü + Input toplamı */
      padding-left: 10px;
      padding-right: 10px;
    }
    
    /* Scrollbar Gizle */
    .chat-area::-webkit-scrollbar { display: none; }

    /* Mesaj Balonları */
    .msg-row { display: flex; width: 100%; flex-shrink: 0; }
    .msg-row.user { justify-content: flex-end; }
    .msg-row.bot { justify-content: flex-start; }

    .bubble {
      max-width: 85%; padding: 12px 16px; border-radius: 18px;
      font-size: 15px; line-height: 1.4; position: relative;
      word-wrap: break-word; box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
    .bubble.user {
      background: #252525; color: #fff;
      border-bottom-right-radius: 4px; border-right: 3px solid #bef264;
    }
    .bubble.bot {
      background: #151515; color: #ddd;
      border-bottom-left-radius: 4px; border-left: 3px solid #ffb300;
    }

    /* 3. INPUT DOCK (YAZI ALANI) */
    .input-dock {
      position: absolute; 
      bottom: calc(var(--footerH) + var(--assistH) + 10px);
      left: 0; width: 100%; 
      z-index: 60;
      padding: 0 10px;
      pointer-events: none; /* Arkaya tıklanabilsin */
      display: flex; justify-content: center;
    }
    
    .dock-inner {
      pointer-events: auto;
      width: 100%; background: #1a1a1a;
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 24px; padding: 8px 10px;
      display: flex; align-items: flex-end; gap: 8px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
    }

    #msgInput {
      flex: 1; max-height: 100px; padding: 10px 5px;
      font-size: 15px; color: #fff; background: transparent;
      border: none; outline: none; resize: none;
    }

    /* 4. ASSISTANT BAR (İKONLAR) */
    .assistant-bar {
      position: absolute; bottom: var(--footerH); 
      left: 0; width: 100%; height: var(--assistH);
      z-index: 50;
      background: linear-gradient(to top, #000 20%, rgba(0,0,0,0));
      display: flex; align-items: center; gap: 8px;
      padding: 0 12px; overflow-x: auto;
      scrollbar-width: none;
    }
    .assistant-bar::-webkit-scrollbar { display: none; }

    /* İkon Stilleri */
    .assistant-item {
      flex: 0 0 auto; display: flex; flex-direction: column; align-items: center;
      gap: 5px; cursor: pointer; width: 68px; transition: transform 0.2s;
    }
    .assistant-item:active { transform: scale(0.95); }

    .ico-wrap {
      width: 44px; height: 44px; border-radius: 14px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.08);
      display: flex; align-items: center; justify-content: center;
      transition: all 0.2s;
    }
    .ico-wrap svg { width: 22px; height: 22px; fill: #aaa; }
    
    .assistant-item[data-active="true"] .ico-wrap {
      background: rgba(255, 179, 0, 0.15); border-color: #ffb300;
    }
    .assistant-item[data-active="true"] svg { fill: #ffb300; }
    
    .lbl { font-size: 10px; font-weight: 700; color: #777; text-transform: uppercase; }

    /* 5. FOOTER (EN ALT) */
    .footer-container {
      position: absolute; bottom: 0; left: 0; width: 100%; height: var(--footerH);
      background: rgba(0,0,0,0.98); border-top: 1px solid rgba(255,255,255,0.08);
      z-index: 40; display: flex; flex-direction: column; justify-content: center;
      padding-bottom: env(safe-area-inset-bottom);
    }

    /* Butonlar */
    .icon-btn svg { width: 24px; height: 24px; stroke: #888; fill: none; }
    .send-btn { 
      background: #bef264; width: 40px; height: 40px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center; flex-shrink: 0;
    }
    .send-btn svg { stroke: #000; fill: none; width: 20px; height: 20px; margin-left: -2px; margin-top: 2px; }

    /* Tahtaravalli */
    .rocking { animation: rock 0.5s infinite alternate ease-in-out; transform-box: fill-box; transform-origin: center; }
    @keyframes rock { from { transform: rotate(-8deg); } to { transform: rotate(8deg); } }

  </style>
</head>

<body>

<div class="mobile-frame" id="mobileFrame">

  <div class="topbar">
    <div class="left-controls">
      <button class="hamb-btn" id="hambBtn" style="background:none;border:none;color:#fff;font-size:24px;">☰</button>
    </div>
    <div class="brand-wrapper" id="brandWrapper">
      <div class="logo-area" style="text-align:center;">
        <svg class="seesaw-svg" viewBox="0 0 40 20" width="40" height="20" style="overflow:visible">
          <g class="seesaw-bar">
            <line x1="0" y1="8" x2="40" y2="8" stroke="#ccc" stroke-width="2" stroke-linecap="round"/>
            <circle cx="3" cy="5" r="3" fill="#bef264"/>
            <circle cx="37" cy="5" r="3" fill="#ffb300"/>
          </g>
          <polygon points="17,14 23,14 20,8" fill="#555"/>
        </svg>
        <div style="font-weight:900;font-size:16px;color:#fff;">Caynana AI</div>
        <div style="font-size:9px;color:#888;">Yapay Zekânın Geleneksel Aklı</div>
      </div>
    </div>
    <div class="right-controls">
      <div style="font-size:10px;background:#333;padding:4px 8px;border-radius:4px;font-weight:bold;color:#ccc;">FREE</div>
    </div>
  </div>

  <div class="chat-area" id="chatArea">
    </div>

  <div class="input-dock">
    <div class="dock-inner">
      <button class="icon-btn" id="plusBtn"><svg viewBox="0 0 24 24"><path d="M12 5v14M5 12h14" stroke-linecap="round" stroke-width="2"/></svg></button>
      <input type="file" id="fileInput" hidden>
      <textarea id="msgInput" rows="1" placeholder="Ne lazım evladım?" spellcheck="false"></textarea>
      <button class="icon-btn" id="micBtn"><svg viewBox="0 0 24 24"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg></button>
      <button class="send-btn" id="sendBtn"><svg viewBox="0 0 24 24"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg></button>
    </div>
  </div>

  <div class="assistant-bar" id="assistantBar">
    <div class="assistant-item" data-go="chat.html" data-active="true"><div class="ico-wrap"><svg viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg></div><div class="lbl">Sohbet</div></div>
    <div class="assistant-item" data-go="translate.html"><div class="ico-wrap"><svg viewBox="0 0 24 24"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg></div><div class="lbl">Alışveriş</div></div>
    <div class="assistant-item" data-go="profil.html"><div class="ico-wrap"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg></div><div class="lbl">Tercüman</div></div>
    <div class="assistant-item" data-go="gossip.html"><div class="ico-wrap"><svg viewBox="0 0 24 24"><path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg></div><div class="lbl">Dedikodu</div></div>
    <div class="assistant-item" data-go="diyet.html"><div class="ico-wrap"><svg viewBox="0 0 24 24"><path d="M12 21a9 9 0 0 0 9-9c0-4.97-4.03-9-9-9-4.97 0-9 4.03-9 9 0 4.97 4.03 9 9 9z"/><path d="M12 3v9"/></svg></div><div class="lbl">Diyet</div></div>
    <div class="assistant-item" data-go="health.html"><div class="ico-wrap"><svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg></div><div class="lbl">Sağlık</div></div>
    <div class="assistant-item" data-go="fal.html"><div class="ico-wrap"><svg viewBox="0 0 24 24"><path d="M18 8h1a4 4 0 0 1 0 8h-1M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8zM6 1v3M10 1v3M14 1v3"/></svg></div><div class="lbl">Fal</div></div>
    <div class="assistant-item" data-go="tarot.html"><div class="ico-wrap"><svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg></div><div class="lbl">Tarot</div></div>
    <div class="assistant-item" data-go="dream.html"><div class="ico-wrap"><svg viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></div><div class="lbl">Rüya</div></div>
    <div class="assistant-item" data-go="astro.html"><div class="ico-wrap"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></svg></div><div class="lbl">Burç</div></div>
  </div>

  <div class="footer-container">
    <div style="display:flex;justify-content:center;gap:15px;margin-bottom:5px;">
      <a href="hakkimizda.html" style="color:#666;text-decoration:none;font-size:11px;font-weight:700;">Hakkımızda</a>
      <a href="iletisim.html" style="color:#666;text-decoration:none;font-size:11px;font-weight:700;">İletişim</a>
    </div>
    <div style="text-align:center;font-size:10px;color:#444;">@CaynanaAI By Ozyigit's 2026</div>
  </div>

</div>

<div id="menuOverlay" style="position:absolute;inset:0;background:rgba(0,0,0,0.8);z-index:9999;display:none;">
  <div style="width:280px;height:100%;background:#111;padding:20px;color:#fff;">
    <button id="closeMenu" style="background:none;border:none;color:#fff;font-size:24px;float:right;">&times;</button>
    <h3>Menü</h3>
    <button onclick="location.reload()" style="width:100%;padding:10px;margin-top:20px;background:#bef264;border:none;border-radius:10px;font-weight:bold;">+ Yeni Sohbet</button>
    <br><br>
    <a href="profil.html" style="color:#ccc;text-decoration:none;display:block;padding:10px;border-bottom:1px solid #333;">Profil</a>
    <a href="hakkimizda.html" style="color:#ccc;text-decoration:none;display:block;padding:10px;border-bottom:1px solid #333;">Hakkımızda</a>
  </div>
</div>

<script type="module">
  import { doSend } from '/js/main.js';

  document.addEventListener("DOMContentLoaded", () => {
    
    const input = document.getElementById('msgInput');
    const sendBtn = document.getElementById('sendBtn');
    const chatArea = document.getElementById('chatArea');
    const seesawBar = document.querySelector('.seesaw-bar');

    // UI Mesaj Ekleme
    window.appendMsgUI = function(text, type) {
      const row = document.createElement('div');
      row.className = `msg-row ${type}`;
      row.innerHTML = `<div class="bubble ${type}">${text}</div>`;
      chatArea.appendChild(row);
      // En son mesaja git
      row.scrollIntoView({ behavior: 'smooth', block: 'end' });
    };

    // Gönderme İşlemi
    async function handleSend() {
      const text = input.value.trim();
      if (!text) return;

      appendMsgUI(text, 'user');
      input.value = '';
      input.style.height = 'auto'; 
      seesawBar.parentElement.classList.remove('rocking');

      // Backend'e Bağlan
      try {
        if (typeof doSend === "function") {
          await doSend(text); 
        } else {
          console.warn("doSend yok, simülasyon.");
          setTimeout(() => appendMsgUI("Bağlantı hatası evladım.", 'bot'), 1000);
        }
      } catch (e) {
        console.error("Hata:", e);
      }
    }

    // Eventler
    sendBtn.addEventListener('click', (e) => { e.preventDefault(); handleSend(); });
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSend(); }
    });

    // Tahtaravalli
    input.addEventListener('input', () => {
      if(input.value.length > 0) seesawBar.parentElement.classList.add("rocking");
      else seesawBar.parentElement.classList.remove("rocking");
      input.style.height = 'auto';
      input.style.height = (input.scrollHeight) + 'px';
    });

    // Menü
    const hamb = document.getElementById("hambBtn");
    const menu = document.getElementById("menuOverlay");
    const closeM = document.getElementById("closeMenu");
    
    if(hamb) hamb.onclick = () => menu.style.display = "block";
    if(closeM) closeM.onclick = () => menu.style.display = "none";
    if(menu) menu.onclick = (e) => { if(e.target===menu) menu.style.display="none"; }

    // Linkler
    document.querySelectorAll('.assistant-item').forEach(item => {
      item.onclick = function() { window.location.href = this.getAttribute('data-go'); }
    });
  });
</script>

<style>
.rocking { animation: rock 0.5s infinite alternate ease-in-out !important; transform-origin:center; transform-box:fill-box; }
@keyframes rock { from { transform: rotate(-8deg); } to { transform: rotate(8deg); } }
</style>

</body>
</html>
