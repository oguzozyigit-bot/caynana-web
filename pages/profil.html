<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Profil Ayarlarƒ± - Caynana.AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="../css/app.css?v=36.0">
    
    <style>
        /* Sayfa √ñzel Stilleri */
        .profile-container { padding: 80px 20px 40px 20px; color: #fff; max-width: 600px; margin: 0 auto; }
        
        .avatar-section { display: flex; flex-direction: column; align-items: center; margin-bottom: 30px; position: relative; }
        .avatar-img { width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--primary); object-fit: cover; box-shadow: 0 0 20px rgba(230, 194, 91, 0.3); }
        .lock-icon { position: absolute; bottom: 0; background: #333; color: #fff; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; border: 1px solid #555; }
        
        .section-title { font-size: 16px; font-weight: 900; color: var(--primary); border-bottom: 1px solid #333; padding-bottom: 10px; margin: 30px 0 20px 0; text-transform: uppercase; letter-spacing: 1px; }
        
        .form-group { margin-bottom: 20px; }
        .form-row { display: flex; gap: 15px; }
        .form-col { flex: 1; }
        
        .form-label { font-size: 13px; font-weight: 700; color: #bbb; margin-bottom: 8px; display: block; }
        .form-label i { color: var(--primary); margin-right: 5px; width: 15px; text-align: center; }
        
        .form-input, .form-select { width: 100%; background: #1a1a1a; border: 1px solid #333; color: #fff; padding: 14px; border-radius: 12px; font-family: 'Outfit', sans-serif; font-size: 14px; outline: none; transition: 0.3s; }
        .form-input:focus, .form-select:focus { border-color: var(--primary); box-shadow: 0 0 10px rgba(230, 194, 91, 0.1); }
        
        /* Gizli Alanlar (Animasyonlu) */
        .hidden-area { display: none; background: #222; padding: 15px; border-radius: 12px; border-left: 3px solid var(--primary); margin-top: 10px; animation: slideDown 0.3s ease; }
        @keyframes slideDown { from {opacity:0; transform:translateY(-10px);} to {opacity:1; transform:translateY(0);} }

        .save-btn { width: 100%; background: var(--primary); color: #000; font-weight: 900; padding: 16px; border-radius: 14px; border: none; font-size: 16px; cursor: pointer; margin-top: 20px; box-shadow: 0 4px 15px rgba(230, 194, 91, 0.2); transition: 0.2s; }
        .save-btn:active { transform: scale(0.98); opacity: 0.9; }
        
        /* Tarih se√ßici ikonu beyaz olsun */
        input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); cursor: pointer; opacity: 0.6; }
    </style>
</head>
<body>

    <div id="app">
        <div id="heroOverlay" style="background: #000; z-index: -1;"></div>

        <div class="sub-page-header" style="display: flex; align-items: center; justify-content: space-between; padding: 15px; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); position: fixed; top: 0; left: 0; right: 0; z-index: 100; border-bottom: 1px solid #222;">
            
            <div onclick="window.location.href='../index.html'" style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-size: 20px; color: #fff; cursor: pointer;">
                <i class="fa-solid fa-arrow-left"></i>
            </div>

            <div class="header-logo" style="font-size: 16px; font-weight: 700; color: var(--primary); letter-spacing: 1px;">
                <i class="fa-solid fa-user-pen"></i> PROFƒ∞L
            </div>

            <div style="width: 40px;"></div>
        </div>

        <div class="page-container profile-container">
            
            <div class="avatar-section">
                <img id="userAvatar" src="https://via.placeholder.com/100" class="avatar-img">
                <div class="lock-icon"><i class="fa-solid fa-lock"></i></div>
                <div style="font-size: 11px; color: #666; margin-top: 8px;">Google Hesabƒ±ndan √áekildi</div>
            </div>

            <div class="section-title">üìã Kimlik Bilgileri</div>

            <div class="form-group">
                <label class="form-label"><i class="fa-solid fa-id-card"></i> Ad Soyad *</label>
                <input type="text" id="fullname" class="form-input" placeholder="Adƒ±nƒ±zƒ± ve Soyadƒ±nƒ±zƒ± yazƒ±nƒ±z...">
            </div>

            <div class="form-group">
                <label class="form-label"><i class="fa-solid fa-comment-dots"></i> Caynana Size Nasƒ±l Hitap Etsin? *</label>
                <input type="text" id="hitap" class="form-input" placeholder="√ñrn: Oƒüuz, Damat, G√ºzelim, Reis...">
                <div style="font-size:10px; color:#666; margin-top:5px;">Sohbetlerde bu ismi kullanacak.</div>
            </div>

            <div class="form-row">
                <div class="form-col">
                    <label class="form-label"><i class="fa-solid fa-venus-mars"></i> Cinsiyet *</label>
                    <select id="gender" class="form-select">
                        <option value="">Se√ßiniz</option>
                        <option value="Kadin">Kadƒ±n</option>
                        <option value="Erkek">Erkek</option>
                    </select>
                </div>
                
                <div class="form-col">
                    <label class="form-label"><i class="fa-solid fa-calendar-days"></i> Doƒüum Tarihi *</label>
                    <input type="date" id="birthDate" class="form-input">
                </div>
            </div>

            <div class="form-row">
                <div class="form-col">
                    <label class="form-label"><i class="fa-solid fa-ruler-vertical"></i> Boy (cm) *</label>
                    <input type="number" id="height" class="form-input" placeholder="175">
                </div>
                <div class="form-col">
                    <label class="form-label"><i class="fa-solid fa-weight-scale"></i> Kilo (kg) *</label>
                    <input type="number" id="weight" class="form-input" placeholder="70">
                </div>
            </div>

            <div class="section-title">üíç Aile ve ƒ∞li≈ükiler (Opsiyonel)</div>

            <div class="form-group">
                <label class="form-label"><i class="fa-solid fa-ring"></i> Medeni Durum</label>
                <select id="maritalStatus" class="form-select" onchange="toggleSpouse()">
                    <option value="">Se√ßiniz</option>
                    <option value="Bekar">Bekar</option>
                    <option value="Evli">Evli</option>
                </select>
                
                <div id="spouseArea" class="hidden-area">
                    <label class="form-label" style="color:#fff;">‚ù§Ô∏è E≈üinizin Adƒ±</label>
                    <input type="text" id="spouseName" class="form-input" placeholder="E≈üinizin ismi...">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label"><i class="fa-solid fa-children"></i> √áocuk Sayƒ±sƒ±</label>
                <select id="childCount" class="form-select" onchange="toggleChildren()">
                    <option value="0">Yok</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4+</option>
                </select>

                <div id="childAgesArea" class="hidden-area">
                    <label class="form-label" style="color:#fff;">üë∂ √áocuklarƒ±n Ya≈ülarƒ± (Virg√ºlle ayƒ±rƒ±n)</label>
                    <input type="text" id="childAges" class="form-input" placeholder="√ñrn: 7, 12">
                </div>
            </div>

            <div class="section-title">üåç Lokasyon ve Diƒüer</div>

            <div class="form-row">
                <div class="form-col">
                    <label class="form-label"><i class="fa-solid fa-earth-europe"></i> √úlke</label>
                    <input type="text" id="country" class="form-input" value="T√ºrkiye">
                </div>
                <div class="form-col">
                    <label class="form-label"><i class="fa-solid fa-city"></i> ƒ∞l</label>
                    <input type="text" id="city" class="form-input" placeholder="ƒ∞stanbul">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label"><i class="fa-solid fa-futbol"></i> Tuttuƒüu Takƒ±m</label>
                <input type="text" id="team" class="form-input" placeholder="Takƒ±m ismi...">
            </div>

            <button class="save-btn" onclick="saveProfile()">
                <i class="fa-solid fa-check-circle"></i> KAYDET VE G√úNCELLE
            </button>
            
            <div style="height:30px;"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 1. Kullanƒ±cƒ± Kontrol√º
            const rawUser = localStorage.getItem("user_info");
            if (!rawUser) {
                alert("L√ºtfen √∂nce giri≈ü yapƒ±n.");
                window.location.href = "../index.html";
                return;
            }
            const user = JSON.parse(rawUser);
            const p = user.profile || {}; // Varsa eski profil verisi
            
            // 2. Avatarƒ± Y√ºkle
            document.getElementById('userAvatar').src = user.picture || "https://via.placeholder.com/100";

            // 3. Ad Soyad (Mantƒ±k: Kayƒ±tlƒ± > Google > Bo≈ü Placeholder)
            let displayName = "";
            if (p.fullname) {
                displayName = p.fullname;
            } else if (user.name && user.name !== "Misafir") {
                displayName = user.name;
            }
            document.getElementById('fullname').value = displayName;

            // 4. Kayƒ±tlƒ± Verileri Geri Y√ºkle
            if(p.hitap) document.getElementById('hitap').value = p.hitap;
            if(p.gender) document.getElementById('gender').value = p.gender;
            if(p.birthDate) document.getElementById('birthDate').value = p.birthDate; // Tarih
            if(p.height) document.getElementById('height').value = p.height;
            if(p.weight) document.getElementById('weight').value = p.weight;
            
            // 5. ≈ûartlƒ± Alanlarƒ± Tetikle
            if(p.maritalStatus) {
                document.getElementById('maritalStatus').value = p.maritalStatus;
                toggleSpouse();
            }
            if(p.spouseName) document.getElementById('spouseName').value = p.spouseName;

            if(p.childCount) {
                document.getElementById('childCount').value = p.childCount;
                toggleChildren();
            }
            if(p.childAges) document.getElementById('childAges').value = p.childAges;

            if(p.country) document.getElementById('country').value = p.country;
            if(p.city) document.getElementById('city').value = p.city;
            if(p.team) document.getElementById('team').value = p.team;
        });

        // E≈ü Adƒ± G√∂ster/Gizle
        function toggleSpouse() {
            const val = document.getElementById('maritalStatus').value;
            const area = document.getElementById('spouseArea');
            area.style.display = (val === 'Evli') ? 'block' : 'none';
        }

        // √áocuk Ya≈ülarƒ± G√∂ster/Gizle
        function toggleChildren() {
            const val = document.getElementById('childCount').value;
            const area = document.getElementById('childAgesArea');
            area.style.display = (val !== '0') ? 'block' : 'none';
        }

        function saveProfile() {
            // Zorunlu Alan Kontrol√º (Doƒüum Tarihi Dahil)
            const requiredIds = ['fullname', 'hitap', 'gender', 'birthDate', 'height', 'weight'];
            for (let id of requiredIds) {
                const val = document.getElementById(id).value.trim();
                if (!val) {
                    alert("L√ºtfen t√ºm zorunlu alanlarƒ± doldurun ba≈ükanƒ±m (* i≈üaretliler).");
                    document.getElementById(id).focus();
                    return;
                }
            }

            // Veriyi Paketle
            const profileData = {
                fullname: document.getElementById('fullname').value.trim(),
                hitap: document.getElementById('hitap').value.trim(),
                gender: document.getElementById('gender').value,
                birthDate: document.getElementById('birthDate').value,
                height: document.getElementById('height').value,
                weight: document.getElementById('weight').value,
                maritalStatus: document.getElementById('maritalStatus').value,
                spouseName: document.getElementById('spouseName').value.trim(),
                childCount: document.getElementById('childCount').value,
                childAges: document.getElementById('childAges').value.trim(),
                country: document.getElementById('country').value.trim(),
                city: document.getElementById('city').value.trim(),
                team: document.getElementById('team').value.trim()
            };

            // LocalStorage G√ºncelle
            let currentUser = JSON.parse(localStorage.getItem("user_info"));
            
            // Profil verisini kaydet
            currentUser.profile = profileData; 
            
            // Ana ismi ve hitabƒ± da g√ºncelle (Men√ºde g√∂r√ºnmesi i√ßin)
            currentUser.hitap = profileData.hitap; 
            currentUser.name = profileData.fullname; 

            localStorage.setItem("user_info", JSON.stringify(currentUser));

            // Buton Efekti
            const btn = document.querySelector('.save-btn');
            btn.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i> Kaydediliyor...`;
            btn.style.opacity = "0.7";

            // Y√∂nlendir
            setTimeout(() => {
                window.location.href = "../index.html";
            }, 1000);
        }
    </script>

</body>
</html>
