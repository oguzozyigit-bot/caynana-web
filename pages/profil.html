<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Profil Ayarlarƒ± - Caynana.AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/app.css?v=26.0">
    
    <style>
        .profile-container { padding: 80px 20px 40px 20px; color: #fff; max-width: 600px; margin: 0 auto; }
        
        /* Avatar Alanƒ± */
        .avatar-section { display: flex; flex-direction: column; align-items: center; margin-bottom: 30px; position: relative; }
        .avatar-img { width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--primary); object-fit: cover; box-shadow: 0 0 20px rgba(230, 194, 91, 0.3); }
        .lock-icon { position: absolute; bottom: 0; background: #333; color: #fff; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; border: 1px solid #555; }
        
        /* Form Elemanlarƒ± */
        .form-group { margin-bottom: 20px; }
        .form-label { font-size: 13px; font-weight: 700; color: var(--primary); margin-bottom: 8px; display: block; }
        .form-input, .form-select, .form-textarea { width: 100%; background: #1a1a1a; border: 1px solid #333; color: #fff; padding: 14px; border-radius: 12px; font-family: 'Outfit', sans-serif; font-size: 14px; outline: none; transition: 0.3s; }
        .form-input:focus, .form-select:focus, .form-textarea:focus { border-color: var(--primary); box-shadow: 0 0 10px rgba(230, 194, 91, 0.1); }
        
        /* Read Only Stil */
        .form-input:disabled { opacity: 0.5; cursor: not-allowed; border-color: #222; }

        /* Checkbox Grubu */
        .checkbox-group { display: flex; gap: 10px; flex-wrap: wrap; }
        .cb-item { background: #1a1a1a; border: 1px solid #333; padding: 10px 16px; border-radius: 20px; font-size: 13px; cursor: pointer; transition: 0.2s; user-select: none; }
        .cb-item.selected { background: var(--primary); color: #000; font-weight: 700; border-color: var(--primary); }

        /* Kaydet Butonu */
        .save-btn { width: 100%; background: var(--primary); color: #000; font-weight: 900; padding: 16px; border-radius: 14px; border: none; font-size: 16px; cursor: pointer; margin-top: 10px; }
        .save-btn:disabled { opacity: 0.5; cursor: wait; }
    </style>
</head>
<body>

    <div id="app">
        <div id="heroOverlay" style="background: #000; z-index: -1;"></div>

        <div class="sub-page-header">
            <div class="header-logo" style="width:100%; text-align:center;">
                <i class="fa-solid fa-user-gear"></i> PROFƒ∞L Bƒ∞LGƒ∞LERƒ∞
            </div>
        </div>

        <div class="page-container profile-container">
            
            <div class="avatar-section">
                <img id="userAvatar" src="https://via.placeholder.com/100" class="avatar-img">
                <div class="lock-icon"><i class="fa-solid fa-lock"></i></div>
                <div style="font-size: 11px; color: #666; margin-top: 8px;">Google Hesabƒ±ndan √áekildi</div>
            </div>

            <div class="form-group">
                <label class="form-label">Kullanƒ±cƒ± ID (Sistem)</label>
                <input type="text" id="userId" class="form-input" disabled value="USER_12345">
            </div>

            <div class="form-group">
                <label class="form-label">üó£Ô∏è Caynana Sana Nasƒ±l Hitap Etsin? *</label>
                <input type="text" id="hitap" class="form-input" placeholder="√ñrn: Oƒüuz, Abi, G√ºzelim, Reis..." maxlength="20">
                <div style="font-size: 10px; color: #666; margin-top: 4px;">Caynana seni bu isimle √ßaƒüƒ±racak. (K√ºf√ºr/Emoji Yasak)</div>
            </div>

            <div class="form-group">
                <label class="form-label">üéØ Kullanƒ±m Amacƒ± (En az 1 tane) *</label>
                <div class="checkbox-group" id="purposeGroup">
                    <div class="cb-item" onclick="toggleCb(this)">Sohbet & Dertle≈üme</div>
                    <div class="cb-item" onclick="toggleCb(this)">Alƒ±≈üveri≈ü Tavsiyesi</div>
                    <div class="cb-item" onclick="toggleCb(this)">Eƒülence & Fal</div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">‚úçÔ∏è Hakkƒ±mda (Opsiyonel)</label>
                <textarea id="about" class="form-textarea" rows="2" placeholder="Kendinden kƒ±saca bahset..." maxlength="140"></textarea>
            </div>

            <div class="form-group">
                <label class="form-label">‚öΩ Tuttuƒüun Takƒ±m (Opsiyonel)</label>
                <input type="text" id="team" class="form-input" placeholder="Takƒ±m ismi...">
            </div>

            <div class="form-group" style="display:flex; gap:10px;">
                <div style="flex:1;">
                    <label class="form-label">Konu≈üma Tarzƒ±</label>
                    <select id="style" class="form-select">
                        <option value="direct">Direkt (Dobra)</option>
                        <option value="soft">Yumu≈üak (Ana√ß)</option>
                        <option value="funny">Umursamaz (Eƒülenceli)</option>
                    </select>
                </div>
                <div style="flex:1;">
                    <label class="form-label">Bildirimler</label>
                    <select id="notif" class="form-select">
                        <option value="on">A√ßƒ±k</option>
                        <option value="off">Kapalƒ±</option>
                    </select>
                </div>
            </div>

            <button class="save-btn" onclick="saveProfile()">
                <i class="fa-solid fa-check"></i> KAYDET VE BA≈ûLA
            </button>

        </div>
    </div>

    <script>
        // Sayfa Y√ºklendiƒüinde
        document.addEventListener('DOMContentLoaded', () => {
            // LocalStorage'dan veriyi √ßek
            const rawUser = localStorage.getItem("user_info");
            if (!rawUser) {
                // Giri≈ü yapƒ±lmamƒ±≈üsa ana sayfaya at
                alert("√ñnce giri≈ü yapmalƒ±sƒ±n ba≈ükanƒ±m.");
                window.location.href = "../index.html";
                return;
            }

            const user = JSON.parse(rawUser);

            // Alanlarƒ± Doldur
            document.getElementById('userAvatar').src = user.picture || "https://via.placeholder.com/100";
            document.getElementById('userId').value = user.id || "Bilinmiyor";
            
            // Eƒüer daha √∂nce kaydedilmi≈ü hitap varsa doldur (ƒ∞lerde backend'den gelirse)
            if(user.hitap) document.getElementById('hitap').value = user.hitap;
        });

        // Checkbox Mantƒ±ƒüƒ±
        function toggleCb(el) {
            el.classList.toggle('selected');
        }

        // Kaydetme Fonksiyonu
        function saveProfile() {
            const hitap = document.getElementById('hitap').value.trim();
            const purposes = document.querySelectorAll('#purposeGroup .cb-item.selected');
            
            // 1. ZORUNLU ALAN KONTROL√ú
            if (!hitap) {
                alert("Caynana sana ne diyecek? Hitap ≈üeklini bo≈ü bƒ±rakma.");
                return;
            }
            if (purposes.length === 0) {
                alert("En az bir kullanƒ±m amacƒ± se√ßmelisin ba≈ükanƒ±m.");
                return;
            }

            // 2. VERƒ∞Yƒ∞ HAZIRLA
            const profileData = {
                hitap: hitap,
                purposes: Array.from(purposes).map(el => el.innerText),
                about: document.getElementById('about').value.trim(),
                team: document.getElementById('team').value.trim(),
                style: document.getElementById('style').value,
                notification: document.getElementById('notif').value
            };

            console.log("Kaydedilecek Profil:", profileData);

            // 3. BACKEND'E G√ñNDER (≈ûimdilik LocalStorage g√ºncelle ve ana sayfaya git)
            // ƒ∞lerde buraya: await fetch('/api/profile', ...) gelecek.
            
            let currentUser = JSON.parse(localStorage.getItem("user_info"));
            currentUser = { ...currentUser, ...profileData }; // Verileri birle≈ütir
            localStorage.setItem("user_info", JSON.stringify(currentUser));

            // Buton Efekti
            const btn = document.querySelector('.save-btn');
            btn.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i> Ayarlanƒ±yor...`;
            
            setTimeout(() => {
                // Ana Sayfaya D√∂n (Profil Tamamlandƒ±)
                window.location.href = "../index.html";
            }, 1000);
        }
    </script>

</body>
</html>
