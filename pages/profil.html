<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Profil Ayarları</title>
    
    <script>
        // Eğer kullanıcı bilgisi yoksa, sayfayı gösterme direkt ana sayfaya at.
        if (!localStorage.getItem("user_info")) {
            window.location.replace("../index.html"); // .href yerine .replace kullandım ki "Geri" tuşu çalışmasın
        }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/app.css?v=56.0">
</head>
<body>
    <div id="app">
        <div id="topbar">
            <div class="topbarGlass">
                <div class="action-btn" onclick="window.location.href='../index.html'">
                    <i class="fa-solid fa-arrow-left"></i>
                </div>
                <div class="brand-logo">PROFİL</div>
                <div style="width:32px;"></div>
            </div>
        </div>

        <div class="page-container">
            <div style="text-align:center; margin-bottom:25px;">
                <img id="userAvatar" src="https://via.placeholder.com/100" style="width:100px; height:100px; border-radius:50%; border:3px solid var(--primary); object-fit:cover;">
                <div style="font-size:11px; color:#666; margin-top:5px;">Google Hesabın</div>
            </div>

            <div class="form-group">
                <label class="form-label">Ad Soyad (Google'dan)</label>
                <input type="text" id="fullname" class="form-input" disabled style="opacity:0.6; cursor:not-allowed;">
            </div>

            <div class="form-group">
                <label class="form-label" style="color:var(--primary); font-weight:900;">Caynana Sana Nasıl Seslensin? (Max 10 Harf)</label>
                <input type="text" id="hitap" class="form-input" maxlength="10" placeholder="Örn: Damat Bey">
            </div>

            <div class="form-group">
                <label class="form-label">Cinsiyet</label>
                <select id="gender" class="form-select">
                    <option value="">Seçiniz</option>
                    <option value="Kadin">Kadın</option>
                    <option value="Erkek">Erkek</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Doğum Tarihi</label>
                <input type="date" id="birthDate" class="form-input">
            </div>

            <div class="form-group">
                <label class="form-label">Medeni Durum</label>
                <select id="maritalStatus" class="form-select">
                    <option value="Bekar">Bekar</option>
                    <option value="Evli">Evli</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Çocuk Sayısı</label>
                <select id="childCount" class="form-select" onchange="toggleChildNames()">
                    <option value="0">Yok</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3+</option>
                </select>
            </div>

            <div id="childNamesArea" class="form-group" style="display:none; background:#222; padding:15px; border-radius:12px; border:1px solid #333;">
                <label class="form-label" style="color:#ddd;">Çocukların İsimleri</label>
                <input type="text" id="childNames" class="form-input" placeholder="Örn: Ali, Ayşe">
            </div>

            <button class="save-btn" onclick="saveProfile()">
                <i class="fa-solid fa-floppy-disk"></i> KAYDET VE ÇIK
            </button>
            <div style="height:50px;"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const rawUser = localStorage.getItem("user_info");
            if(rawUser) {
                const u = JSON.parse(rawUser);
                const p = u.profile || {};
                
                document.getElementById('userAvatar').src = u.picture || "https://via.placeholder.com/100";
                document.getElementById('fullname').value = p.fullname || u.name || "";
                
                if(u.hitap) document.getElementById('hitap').value = u.hitap;
                if(p.gender) document.getElementById('gender').value = p.gender;
                if(p.birthDate) document.getElementById('birthDate').value = p.birthDate;
                if(p.maritalStatus) document.getElementById('maritalStatus').value = p.maritalStatus;
                
                if(p.childCount) { 
                    document.getElementById('childCount').value = p.childCount; 
                    toggleChildNames();
                }
                if(p.childNames) document.getElementById('childNames').value = p.childNames;
            }
        });

        function toggleChildNames() {
            const val = document.getElementById('childCount').value;
            document.getElementById('childNamesArea').style.display = (val !== '0') ? 'block' : 'none';
        }

        function saveProfile() {
            const hitap = document.getElementById('hitap').value.trim();
            if(!hitap) { alert("Hitap ismi boş olamaz!"); return; }

            const profile = {
                fullname: document.getElementById('fullname').value,
                gender: document.getElementById('gender').value,
                birthDate: document.getElementById('birthDate').value,
                maritalStatus: document.getElementById('maritalStatus').value,
                childCount: document.getElementById('childCount').value,
                childNames: document.getElementById('childNames').value
            };

            let u = JSON.parse(localStorage.getItem("user_info")) || {};
            u.hitap = hitap;
            u.profile = profile;
            localStorage.setItem("user_info", JSON.stringify(u));
            
            const btn = document.querySelector('.save-btn');
            btn.innerHTML = `<i class="fa-solid fa-check"></i> KAYDEDİLDİ`;
            btn.style.background = "#4CAF50";
            
            setTimeout(() => { window.location.href = "../index.html"; }, 1000);
        }
    </script>
</body>
</html>
